<div class="swse-sheet">
<!-- SWSE Character Generator Template - Fixed -->
<div class="chargen-app swse-chargen">
 <header class="chargen-header">
 <h2>Star Wars Saga Edition Character Generator</h2>
 <div class="step-indicator">Step: <strong>{{currentStep}}</strong></div>
 <div class="free-build-controls">
 <label class="free-build-label">
 <input type="checkbox" class="free-build-toggle" {{checked freeBuild}}>
 <i class="fas fa-unlock-alt"></i> <strong>Free Build Mode</strong>
 <span class="hint-text">Skip validation and build freely</span>
 </label>
 </div>
 </header>

 {{!-- Chevron Progress Indicator --}}
 <div class="chargen-progress-chevron">
 <div class="chevron-step {{#if (eq currentStep 'name')}}active{{/if}} {{#if characterData.name}}completed{{/if}} {{#if (or (eq currentStep 'name') freeBuild)}}clickable{{/if}}" data-step="name">
 <span class="chevron-label">Name</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'type')}}active{{/if}} {{#if (or characterData.isDroid characterData.species)}}completed{{/if}} {{#if (or (or characterData.isDroid characterData.species) freeBuild)}}clickable{{/if}}" data-step="type">
 <span class="chevron-label">Type</span>
 </div>

 {{#if characterData.isDroid}}
 <div class="chevron-step {{#if (eq currentStep 'degree')}}active{{/if}} {{#if characterData.droidDegree}}completed{{/if}} {{#if (or characterData.droidDegree freeBuild)}}clickable{{/if}}" data-step="degree">
 <span class="chevron-label">Degree</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'size')}}active{{/if}} {{#if characterData.droidSize}}completed{{/if}} {{#if (or characterData.droidSize freeBuild)}}clickable{{/if}}" data-step="size">
 <span class="chevron-label">Size</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'droid-builder')}}active{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="droid-builder">
 <span class="chevron-label">Systems</span>
 </div>
 {{else}}
 <div class="chevron-step {{#if (eq currentStep 'species')}}active{{/if}} {{#if characterData.species}}completed{{/if}} {{#if (or characterData.species freeBuild)}}clickable{{/if}}" data-step="species">
 <span class="chevron-label">Species</span>
 </div>
 {{/if}}

 <div class="chevron-step {{#if (eq currentStep 'abilities')}}active{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="abilities">
 <span class="chevron-label">Abilities</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'class')}}active{{/if}} {{#if (gt characterData.classes.length 0)}}completed{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="class">
 <span class="chevron-label">Class</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'background')}}active{{/if}} {{#if characterData.background}}completed{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="background">
 <span class="chevron-label">Background</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'skills')}}active{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="skills">
 <span class="chevron-label">Skills</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'languages')}}active{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="languages">
 <span class="chevron-label">Languages</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'feats')}}active{{/if}} {{#if (gte characterData.feats.length characterData.featsRequired)}}completed{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="feats">
 <span class="chevron-label">Feats</span>
 </div>

 <div class="chevron-step {{#if (eq currentStep 'talents')}}active{{/if}} {{#if (gt characterData.talents.length 0)}}completed{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="talents">
 <span class="chevron-label">Talents</span>
 </div>

 {{!-- Force powers only for Force-sensitive living characters (droids cannot be Force-sensitive in SWSE) --}}
 {{#if characterData.forceSensitive}}
 {{#unless characterData.isDroid}}
 <div class="chevron-step {{#if (eq currentStep 'force-powers')}}active{{/if}} {{#if (gte characterData.powers.length characterData.forcePowersRequired)}}completed{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="force-powers">
 <span class="chevron-label">Force Powers</span>
 </div>
 {{/unless}}
 {{/if}}

 {{!-- Starship Maneuvers only for characters with Starship Tactics feat --}}
 {{#if characterData.starshipManeuversRequired}}
 <div class="chevron-step {{#if (eq currentStep 'starship-maneuvers')}}active{{/if}} {{#if (gte characterData.starshipManeuvers.length characterData.starshipManeuversRequired)}}completed{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="starship-maneuvers">
 <span class="chevron-label">Starship Maneuvers</span>
 </div>
 {{/if}}

 {{#if characterData.isDroid}}
 <div class="chevron-step {{#if (eq currentStep 'droid-final')}}active{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="droid-final">
 <span class="chevron-label">Finalize Droid</span>
 </div>
 {{/if}}

 <div class="chevron-step {{#if (eq currentStep 'summary')}}active{{/if}} {{#if freeBuild}}clickable{{/if}}" data-step="summary">
 <span class="chevron-label">Summary</span>
 </div>
 </div>

 <main class="chargen-body">
 {{#if (eq currentStep "name")}}
 <section class="step-name">
 <h3>Character Name & Level</h3>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 <div class="form-group">
 <label for="character-name">Enter your character's name:</label>
 <input
 id="character-name"
 name="character-name"
 type="text"
 class="chargen-name-input"
 value="{{characterData.name}}"
 placeholder="Enter name..."
 autofocus />
 </div>
 <div class="random-name-container">
 <div class="random-buttons-grid">
 <div>
 <button type="button" class="random-name-btn btn-secondary">
 <i class="fas fa-dice"></i> Random Name
 </button>
 <span class="hint-text">Character name</span>
 </div>
 <div>
 <button type="button" class="random-droid-name-btn btn-secondary">
 <i class="fas fa-dice"></i> Random Droid Name
 </button>
 <span class="hint-text">Droid designation</span>
 </div>
 </div>
 </div>
 <div class="form-group">
 <label for="target-level-input">Starting Level:</label>
 <div class="level-selector">
 <input
 id="target-level-input"
 name="target-level"
 type="number"
 class="chargen-level-input"
 value="{{targetLevel}}"
 min="1"
 max="20"
 placeholder="1" />
 <span class="level-hint">Levels 2-20 will be automatically applied after character creation</span>
 </div>
 </div>

 <div class="form-actions">
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "type")}}
 <section class="step-type">
 <h3>What are you?</h3>
 <p class="hint">Choose whether you're creating a living being or a droid character.</p>
 <div class="type-grid">
 <button type="button" class="select-type choice-button" data-type="living">
 <i class="fas fa-user"></i>
 <h4>Living Being</h4>
 <p>Organic species with unique traits</p>
 </button>
 <button type="button" class="select-type choice-button" data-type="droid">
 <i class="fas fa-robot"></i>
 <h4>Droid</h4>
 <p>Mechanical beings with specialized functions</p>
 </button>
 </div>
 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "degree")}}
 <section class="step-degree">
 <h3>Select Droid Degree</h3>
 <p class="hint">Choose your droid's classification and specialization.</p>

 {{#if seraphimDialogue}}
 <div class="holo-banner seraphim-dialogue-box">
   <div class="shopkeeper-portrait">
     <img src="systems/foundryvtt-swse/assets/mentors/seraphim.webp" alt="Seraphim"/>
   </div>
   <div class="holo-content">
     <div class="holo-speaker">
       <i class="fas fa-robot"></i>
       <span>SERAPHIM - SELF-AWARE AI</span>
     </div>
     <div class="holo-message">{{seraphimDialogue}}</div>
   </div>
 </div>
 {{/if}}

 <div class="import-option">
 <button type="button" class="import-droid-btn btn-primary">
 <i class="fas fa-download"></i> Import Existing Droid Type
 </button>
 <p class="import-hint">Or select a degree below to build from scratch</p>
 </div>

 <div class="degree-grid">
 {{#each droidDegrees}}
 <button type="button" class="select-degree choice-button" data-degree="{{this.key}}">
 <h4>{{this.name}}</h4>
 <div class="bonuses">{{this.bonuses}}</div>
 <p class="description">{{this.description}}</p>
 </button>
 {{/each}}
 </div>
 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "size")}}
 <section class="step-size">
 <h3>Select Droid Size</h3>
 <p class="hint">Size determines your Cost Factor, ability modifiers, and base statistics.</p>

 {{#if seraphimDialogue}}
 <div class="holo-banner seraphim-dialogue-box">
   <div class="shopkeeper-portrait">
     <img src="systems/foundryvtt-swse/assets/mentors/seraphim.webp" alt="Seraphim"/>
   </div>
   <div class="holo-content">
     <div class="holo-speaker">
       <i class="fas fa-robot"></i>
       <span>SERAPHIM - SELF-AWARE AI</span>
     </div>
     <div class="holo-message">{{seraphimDialogue}}</div>
   </div>
 </div>
 {{/if}}

 <div class="size-grid-full">
 <button type="button" class="select-size choice-button" data-size="tiny">
 <h4>Tiny</h4>
 <p><strong>CF:</strong> 5× | <strong>Mod:</strong> +4 DEX, -4 STR</p>
 <p><strong>Reflex:</strong> +2 | <strong>Stealth:</strong> +10</p>
 </button>

 <button type="button" class="select-size choice-button" data-size="small">
 <h4>Small</h4>
 <p><strong>CF:</strong> 2× | <strong>Mod:</strong> +2 DEX, -2 STR</p>
 <p><strong>Reflex:</strong> +1 | <strong>Stealth:</strong> +5</p>
 </button>

 <button type="button" class="select-size choice-button recommended" data-size="medium">
 <h4>Medium ★</h4>
 <p><strong>CF:</strong> 1× | <strong>Mod:</strong> None</p>
 <p>Recommended for players</p>
 </button>

 <button type="button" class="select-size choice-button" data-size="large">
 <h4>Large</h4>
 <p><strong>CF:</strong> 2× | <strong>Mod:</strong> +4 STR, -2 DEX</p>
 <p><strong>Reflex:</strong> -1 | <strong>Stealth:</strong> -5</p>
 </button>

 <button type="button" class="select-size choice-button" data-size="huge">
 <h4>Huge</h4>
 <p><strong>CF:</strong> 5× | <strong>Mod:</strong> +8 STR, -4 DEX</p>
 <p><strong>Reflex:</strong> -2 | <strong>Stealth:</strong> -10</p>
 </button>

 <button type="button" class="select-size choice-button" data-size="gargantuan">
 <h4>Gargantuan</h4>
 <p><strong>CF:</strong> 10× | <strong>Mod:</strong> +12 STR, -4 DEX</p>
 <p><strong>Reflex:</strong> -4 | <strong>Stealth:</strong> -15</p>
 </button>

 <button type="button" class="select-size choice-button" data-size="colossal">
 <h4>Colossal</h4>
 <p><strong>CF:</strong> 20× | <strong>Mod:</strong> +16 STR, -4 DEX</p>
 <p><strong>Reflex:</strong> -5 | <strong>Stealth:</strong> -20</p>
 </button>
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "species")}}
 <section class="step-species">
 <h3>Select Species</h3>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 {{!-- Species Filters --}}
 <div class="species-filters">
 <div class="filter-header">
 <i class="fas fa-filter"></i>
 <span class="filter-title">Filter Species</span>
 <span class="filter-badge" style="display: none; background: #ff6b6b; color: white; border-radius: 50%; width: 24px; height: 24px; display: inline-flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; margin-left: 8px;">0</span>
 </div>
 <div class="filter-controls">
 <div class="filter-group">
 <label for="species-filter-bonus">Attribute Bonus:</label>
 <select id="species-filter-bonus" class="species-filter-select" data-filter="attributeBonus">
 <option value="">Any</option>
 <option value="str" {{#if (eq characterData.speciesFilters.attributeBonus 'str')}}selected{{/if}}>STR</option>
 <option value="dex" {{#if (eq characterData.speciesFilters.attributeBonus 'dex')}}selected{{/if}}>DEX</option>
 <option value="con" {{#if (eq characterData.speciesFilters.attributeBonus 'con')}}selected{{/if}}>CON</option>
 <option value="int" {{#if (eq characterData.speciesFilters.attributeBonus 'int')}}selected{{/if}}>INT</option>
 <option value="wis" {{#if (eq characterData.speciesFilters.attributeBonus 'wis')}}selected{{/if}}>WIS</option>
 <option value="cha" {{#if (eq characterData.speciesFilters.attributeBonus 'cha')}}selected{{/if}}>CHA</option>
 </select>
 </div>
 <div class="filter-group">
 <label for="species-filter-penalty">Attribute Penalty:</label>
 <select id="species-filter-penalty" class="species-filter-select" data-filter="attributePenalty">
 <option value="">Any</option>
 <option value="str" {{#if (eq characterData.speciesFilters.attributePenalty 'str')}}selected{{/if}}>STR</option>
 <option value="dex" {{#if (eq characterData.speciesFilters.attributePenalty 'dex')}}selected{{/if}}>DEX</option>
 <option value="con" {{#if (eq characterData.speciesFilters.attributePenalty 'con')}}selected{{/if}}>CON</option>
 <option value="int" {{#if (eq characterData.speciesFilters.attributePenalty 'int')}}selected{{/if}}>INT</option>
 <option value="wis" {{#if (eq characterData.speciesFilters.attributePenalty 'wis')}}selected{{/if}}>WIS</option>
 <option value="cha" {{#if (eq characterData.speciesFilters.attributePenalty 'cha')}}selected{{/if}}>CHA</option>
 </select>
 </div>
 <div class="filter-group">
 <label for="species-filter-size">Size:</label>
 <select id="species-filter-size" class="species-filter-select" data-filter="size">
 <option value="">Any</option>
 <option value="Tiny" {{#if (eq characterData.speciesFilters.size 'Tiny')}}selected{{/if}}>Tiny</option>
 <option value="Small" {{#if (eq characterData.speciesFilters.size 'Small')}}selected{{/if}}>Small</option>
 <option value="Medium" {{#if (eq characterData.speciesFilters.size 'Medium')}}selected{{/if}}>Medium</option>
 <option value="Large" {{#if (eq characterData.speciesFilters.size 'Large')}}selected{{/if}}>Large</option>
 <option value="Huge" {{#if (eq characterData.speciesFilters.size 'Huge')}}selected{{/if}}>Huge</option>
 <option value="Gargantuan" {{#if (eq characterData.speciesFilters.size 'Gargantuan')}}selected{{/if}}>Gargantuan</option>
 <option value="Colossal" {{#if (eq characterData.speciesFilters.size 'Colossal')}}selected{{/if}}>Colossal</option>
 </select>
 </div>
 <div class="filter-group">
 <button type="button" class="clear-species-filters btn-secondary">
 <i class="fas fa-times"></i> Clear Filters
 </button>
 </div>
 </div>
 </div>

 <div class="species-grid">
 {{#each packs.species}}
 <button type="button" class="preview-species choice-button"
         data-species="{{this.name}}"
         data-size="{{this.system.size}}"
         data-speed="{{this.system.speed}}"
         data-abilities="{{this.system.abilities}}"
         data-skill-bonuses="{{json this.system.skillBonuses}}"
         data-special="{{json this.system.special}}"
         data-racial-traits="{{json this.system.racialTraits}}"
         style="background-image: linear-gradient(rgba(10, 15, 26, 0.7), rgba(10, 15, 26, 0.8)), url('systems/foundryvtt-swse/assets/species/{{this.name}}.webp'), url('systems/foundryvtt-swse/assets/species/{{this.name}}.jpg');">
 <h4>{{this.name}}</h4>
 {{#if this.system.size}}
 <div class="species-size">
 <span class="size-label">Size: {{this.system.size}}</span>
 </div>
 {{/if}}
 {{#if this.system.abilities}}
 <div class="bonuses">
 <span class="bonus">{{this.system.abilities}}</span>
 </div>
 {{/if}}
 {{#if this.system.skillBonuses}}
 <div class="skill-bonuses">
 {{#each this.system.skillBonuses}}
 <span class="skill-bonus">{{this}}</span>
 {{/each}}
 </div>
 {{/if}}
 {{#if this.system.special}}
 <div class="special-abilities">
 {{#each this.system.special}}
 <span class="special-ability">{{this}}</span>
 {{/each}}
 </div>
 {{/if}}
 </button>
 {{!-- Add Near-Human option right after Human --}}
 {{#if (eq this.name "Human")}}
 <button type="button" class="open-near-human-builder choice-button near-human-card">
 <h4><i class="fas fa-dna"></i> Near-Human</h4>
 <div class="species-size">
 <span class="size-label">Size: Medium</span>
 </div>
 <div class="bonuses">
 <span class="bonus">Custom (+2/-2)</span>
 </div>
 <div class="special-abilities">
 <span class="special-ability">Build your own human variant</span>
 <span class="special-ability">Choose 1 adaptation, 1 sacrifice</span>
 </div>
 </button>
 {{/if}}
 {{/each}}
 </div>

 {{!-- Species Expanded Card Overlay --}}
 <div class="species-overlay" id="species-overlay">
   <div class="species-card-expanded">
     <button type="button" class="species-close-btn" id="species-close-btn">
       <i class="fas fa-times"></i>
     </button>

     {{!-- Ol' Salty Dialogue Banner --}}
     <div class="ol-salty-banner" id="ol-salty-banner">
       <div class="ol-salty-portrait">
         <i class="fas fa-anchor"></i>
       </div>
       <div class="ol-salty-content">
         <div class="ol-salty-name">OL' SALTY</div>
         <div class="ol-salty-dialogue" id="ol-salty-dialogue">
           "Well, well... let's see what you've got."
         </div>
       </div>
     </div>

     <div class="species-expanded-header">
       <h2 id="expanded-species-name">Species Name</h2>
       <div class="species-subtitle" id="expanded-species-source">Core Rulebook</div>
     </div>

     <div class="species-expanded-stats">
       <div class="species-stat-box">
         <span class="stat-label">Size</span>
         <span class="stat-value" id="expanded-species-size">Medium</span>
       </div>
       <div class="species-stat-box">
         <span class="stat-label">Speed</span>
         <span class="stat-value" id="expanded-species-speed">6 squares</span>
       </div>
     </div>

     <div class="species-expanded-section" id="expanded-abilities-section">
       <h3>Ability Modifiers</h3>
       <div id="expanded-species-abilities"></div>
     </div>

     <div class="species-expanded-section" id="expanded-summary-section">
       <h3>Key Effects</h3>
       <ul class="summary-list" id="expanded-species-summary"></ul>
     </div>

     <div class="species-expanded-section" id="expanded-skills-section">
       <h3>Skill Bonuses</h3>
       <ul class="skill-list" id="expanded-species-skills"></ul>
     </div>

     <div class="species-expanded-section" id="expanded-special-section">
       <h3>Special Abilities</h3>
       <ul class="special-list" id="expanded-species-special"></ul>
     </div>

     <div class="species-expanded-actions">
       <button type="button" class="species-back-btn" id="species-back-btn">
         <i class="fas fa-arrow-left"></i> Back
       </button>
       <button type="button" class="species-confirm-btn" id="species-confirm-btn">
         <i class="fas fa-check"></i> Select Species
       </button>
     </div>
   </div>
 </div>

 {{!-- Near-Human Builder Overlay - Official SWSE Rules --}}
 <div class="species-overlay" id="near-human-overlay">
   <div class="species-card-expanded near-human-forge">
     <button type="button" class="species-close-btn" id="near-human-close-btn">
       <i class="fas fa-times"></i>
     </button>

     <div class="species-expanded-header">
       <h2>Near-Human Species Builder</h2>
       <div class="species-subtitle">Create a custom near-human variant per official SWSE rules</div>
     </div>

     <div class="near-human-sections">
       {{!-- Trait Selection --}}
       <section class="near-human-section traits-section">
         <h3><i class="fas fa-dna"></i> Select One Trait</h3>
         <p class="section-hint">Choose one trait from the 24 official Near-Human Traits (per SWSE rules)</p>
         <div class="traits-scroll" id="traits-list">
           {{!-- Traits will be populated by JavaScript from near-human-traits.json --}}
         </div>
         <div class="selected-trait" id="selected-trait">
           <span class="placeholder">Select a trait above</span>
         </div>
       </section>

       {{!-- Sacrifice Selection --}}
       <section class="near-human-section sacrifice-section">
         <h3><i class="fas fa-exchange-alt"></i> Choose What to Sacrifice</h3>
         <p class="section-hint">Your Near-Human trait replaces either a bonus Feat OR bonus Trained Skill</p>
         <div class="sacrifice-options" id="sacrifice-options">
           <label class="radio-label">
             <input type="radio" class="sacrifice-radio" name="near-human-sacrifice" value="feat">
             <strong>Bonus Feat</strong><br/>
             <span>Lose the human bonus feat at 1st level, keep the bonus trained skill</span>
           </label>
           <label class="radio-label">
             <input type="radio" class="sacrifice-radio" name="near-human-sacrifice" value="skill">
             <strong>Bonus Trained Skill</strong><br/>
             <span>Lose the human bonus trained skill, keep the bonus feat</span>
           </label>
         </div>
         <div class="selected-sacrifice" id="selected-sacrifice">
           <span class="placeholder">Choose which human bonus to trade</span>
         </div>
       </section>

       {{!-- Optional Variants --}}
       <section class="near-human-section variants-section">
         <h3><i class="fas fa-sparkles"></i> Optional Cosmetic Variants</h3>
         <p class="section-hint">Select 0-3 cosmetic variations (mostly cosmetic, GM discretion on mechanical effects)</p>
         <div class="variants-list" id="variants-list">
           {{!-- Variants will be populated by JavaScript from near-human-traits.json --}}
         </div>
         <div class="selected-variants" id="selected-variants">
           <span class="placeholder">No variants selected (optional)</span>
         </div>
       </section>

       {{!-- Ability Adjustment (if Ability Adjustment trait selected) --}}
       <section class="near-human-section ability-adjustment-section" id="ability-adjustment-section" style="display: none;">
         <h3><i class="fas fa-chart-line"></i> Adjust Ability Scores</h3>
         <p class="section-hint">Customize each ability by ±1. Total adjustments must equal 0.</p>
         <div class="ability-adjustments" id="ability-adjustments">
           {{!-- Ability adjustment controls will be populated by JavaScript --}}
         </div>
         <div class="ability-adjustment-total" id="ability-adjustment-total">
           <span>Total Adjustment: <strong id="adjustment-total-value">0</strong></span>
         </div>
       </section>
     </div>

     <div class="near-human-validation" id="near-human-validation">
       <span class="validation-message"></span>
     </div>

     <div class="species-expanded-actions">
       <button type="button" class="species-randomize-btn" id="near-human-randomize-btn" title="Randomly select trait, sacrifice, and variants">
         <i class="fas fa-dice"></i> Randomize
       </button>
       <button type="button" class="species-back-btn" id="near-human-back-btn">
         <i class="fas fa-arrow-left"></i> Back
       </button>
       <button type="button" class="species-confirm-btn" id="near-human-confirm-btn" disabled>
         <i class="fas fa-check"></i> Confirm Near-Human
       </button>
     </div>
   </div>
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "droid-builder")}}
 <section class="step-droid-builder holo-shop">
 {{!-- Holographic Welcome Banner --}}
 <div class="holo-banner">
 <div class="holo-speaker">
 <i class="fas fa-volume-up"></i>
 <span class="speaker-name">RENDARR:</span>
 </div>
 <div class="holo-message">
 "Welcome to my shop, lad! Spend to your heart's desire!"
 </div>
 </div>

 {{!-- Credit Balance Display (Prominent) --}}
 <div class="credit-wallet">
 <div class="wallet-header">
 <i class="fas fa-wallet"></i>
 <span>ACCOUNT BALANCE</span>
 </div>
 <div class="wallet-amount">
 <span class="credits-icon">₢</span>
 <span class="remaining-credits {{#if (lt characterData.droidCredits.remaining 0)}}overbudget{{/if}}">{{characterData.droidCredits.remaining}}</span>
 <span class="credits-label">credits</span>
 </div>
 <div class="wallet-details">
 <div class="wallet-detail-item">
 <span class="detail-label">Budget:</span>
 <span class="base-credits">{{characterData.droidCredits.base}}</span> cr
 </div>
 <div class="wallet-detail-item">
 <span class="detail-label">Spent:</span>
 <span class="spent-credits">{{characterData.droidSystems.totalCost}}</span> cr
 </div>
 </div>
 </div>

 {{!-- Main Shop Interface --}}
 <div class="holo-datapad">
 <nav class="shop-tabs">
 <button type="button" class="shop-tab active" data-tab="locomotion">
 <i class="fas fa-shoe-prints"></i>
 <span class="tab-label">Locomotion</span>
 <span class="required-badge">REQUIRED</span>
 </button>
 <button type="button" class="shop-tab" data-tab="processor">
 <i class="fas fa-microchip"></i>
 <span class="tab-label">Processors</span>
 <span class="required-badge">REQUIRED</span>
 </button>
 <button type="button" class="shop-tab" data-tab="appendages">
 <i class="fas fa-hand-paper"></i>
 <span class="tab-label">Appendages</span>
 <span class="required-badge">REQUIRED</span>
 </button>
 <button type="button" class="shop-tab" data-tab="accessories">
 <i class="fas fa-tools"></i>
 <span class="tab-label">Accessories</span>
 </button>
 <button type="button" class="shop-tab cart-tab" data-tab="cart">
 <i class="fas fa-shopping-cart"></i>
 <span class="tab-label">Cart</span>
 <span class="cart-count" id="cart-count">2</span>
 </button>
 </nav>

 <div class="shop-content">
 {{!-- Locomotion Tab --}}
 <div class="shop-panel active" data-panel="locomotion">
 <div class="panel-header">
 <h4><i class="fas fa-shoe-prints"></i> Locomotion Systems</h4>
 <p class="panel-desc">Choose how your droid moves through the galaxy</p>
 </div>
 <div id="locomotion-list" class="product-grid"></div>
 </div>

 {{!-- Processor Tab --}}
 <div class="shop-panel" data-panel="processor">
 <div class="panel-header">
 <h4><i class="fas fa-microchip"></i> Processor Units</h4>
 <p class="panel-desc">The brain of your droid. Heuristic processor included free.</p>
 </div>
 <div id="processor-list" class="product-grid"></div>
 </div>

 {{!-- Appendages Tab --}}
 <div class="shop-panel" data-panel="appendages">
 <div class="panel-header">
 <h4><i class="fas fa-hand-paper"></i> Appendages</h4>
 <p class="panel-desc">Tools and manipulators. Two hands included free.</p>
 </div>
 <div id="appendages-list" class="product-grid"></div>
 </div>

 {{!-- Accessories Tab --}}
 <div class="shop-panel" data-panel="accessories">
 <div class="panel-header">
 <h4><i class="fas fa-tools"></i> Accessories & Upgrades</h4>
 <p class="panel-desc">Enhance your droid with specialized equipment</p>
 </div>
 <nav class="accessory-tabs">
 <button type="button" class="accessory-tab active" data-accessorytab="armor">
 <i class="fas fa-shield-alt"></i> Armor
 </button>
 <button type="button" class="accessory-tab" data-accessorytab="communications">
 <i class="fas fa-broadcast-tower"></i> Comms
 </button>
 <button type="button" class="accessory-tab" data-accessorytab="sensors">
 <i class="fas fa-radar"></i> Sensors
 </button>
 <button type="button" class="accessory-tab" data-accessorytab="shields">
 <i class="fas fa-shield-halved"></i> Shields
 </button>
 <button type="button" class="accessory-tab" data-accessorytab="translators">
 <i class="fas fa-language"></i> Translators
 </button>
 <button type="button" class="accessory-tab" data-accessorytab="miscellaneous">
 <i class="fas fa-box"></i> Misc
 </button>
 </nav>
 <div class="accessory-content">
 <div class="accessory-panel active" data-accessory-panel="armor">
 <div id="accessories-armor" class="product-grid"></div>
 </div>
 <div class="accessory-panel" data-accessory-panel="communications">
 <div id="accessories-communications" class="product-grid"></div>
 </div>
 <div class="accessory-panel" data-accessory-panel="sensors">
 <div id="accessories-sensors" class="product-grid"></div>
 </div>
 <div class="accessory-panel" data-accessory-panel="shields">
 <div id="accessories-shields" class="product-grid"></div>
 </div>
 <div class="accessory-panel" data-accessory-panel="translators">
 <div id="accessories-translators" class="product-grid"></div>
 </div>
 <div class="accessory-panel" data-accessory-panel="miscellaneous">
 <div id="accessories-miscellaneous" class="product-grid"></div>
 </div>
 </div>
 </div>

 {{!-- Cart Tab --}}
 <div class="shop-panel cart-panel" data-panel="cart">
 <div class="panel-header">
 <h4><i class="fas fa-shopping-cart"></i> Your Cart</h4>
 <p class="panel-desc">Review your droid configuration</p>
 </div>

 <div class="cart-container">
 <div class="cart-section">
 <h5 class="cart-section-title">
 <i class="fas fa-gift"></i> Included (Free)
 </h5>
 <div class="cart-items">
 <div class="cart-item free-item">
 <div class="item-icon"><i class="fas fa-microchip"></i></div>
 <div class="item-details">
 <div class="item-name">Heuristic Processor</div>
 <div class="item-specs">Standard droid brain unit</div>
 </div>
 <div class="item-price">
 <span class="price-amount free">FREE</span>
 </div>
 </div>
 <div class="cart-item free-item">
 <div class="item-icon"><i class="fas fa-hand-paper"></i></div>
 <div class="item-details">
 <div class="item-name">Hand Appendages (×2)</div>
 <div class="item-specs">Basic manipulators</div>
 </div>
 <div class="item-price">
 <span class="price-amount free">FREE</span>
 </div>
 </div>
 </div>
 </div>

 <div class="cart-section" id="cart-purchased-section">
 <h5 class="cart-section-title">
 <i class="fas fa-shopping-bag"></i> Purchased Systems
 </h5>
 <div class="cart-items" id="cart-items-list">
 <div class="cart-empty-message">
 <i class="fas fa-box-open"></i>
 <p>No systems added yet. Browse the shop to customize your droid!</p>
 </div>
 </div>
 </div>

 <div class="cart-summary">
 <div class="summary-line">
 <span class="summary-label">Subtotal:</span>
 <span class="summary-value"><span class="spent-credits">0</span> cr</span>
 </div>
 <div class="summary-line">
 <span class="summary-label">Total Weight:</span>
 <span class="summary-value"><span class="total-weight">10</span> kg</span>
 </div>
 <div class="summary-line total-line">
 <span class="summary-label">Total Cost:</span>
 <span class="summary-value">
 <span class="credits-icon">₢</span>
 <span class="spent-credits">0</span>
 </span>
 </div>
 </div>

 <div class="cart-validation" id="cart-validation">
 <div class="validation-item" id="validation-locomotion">
 <i class="fas fa-exclamation-circle"></i>
 <span>Locomotion system required</span>
 </div>
 </div>
 </div>
 </div>
 </div>
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 <button type="button" class="build-later-droid btn-tertiary" id="droid-builder-later">
 Build Later <i class="fas fa-hourglass-end"></i>
 </button>
 <button type="button" class="next-step btn-primary" id="droid-builder-next">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "background")}}
 <section class="step-background">
 <h3>Choose Your Background</h3>
 <p class="hint">Your background represents a defining aspect of your past. Choose ONE from Events, Occupations, or Planets.</p>

 {{!-- Ol' Salty's Commentary --}}
 {{#if characterData.backgroundNarratorComment}}
 <div class="narrator-comment background-narrator">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{characterData.backgroundNarratorComment}}</p>
 </div>
 </div>
 {{/if}}

 {{!-- Category Tabs --}}
 <div class="background-category-tabs">
 <button type="button" class="background-category-tab {{#if (eq characterData.backgroundCategory 'events')}}active{{else}}{{#unless characterData.backgroundCategory}}active{{/unless}}{{/if}}" data-category="events">
 <i class="fas fa-bolt"></i>
 <span>Defining Events</span>
 </button>
 <button type="button" class="background-category-tab {{#if (eq characterData.backgroundCategory 'occupations')}}active{{/if}}" data-category="occupations">
 <i class="fas fa-briefcase"></i>
 <span>Past Occupations</span>
 </button>
 <button type="button" class="background-category-tab {{#if (eq characterData.backgroundCategory 'planets')}}active{{/if}}" data-category="planets">
 <i class="fas fa-globe"></i>
 <span>Planet of Origin</span>
 </button>
 </div>

 {{!-- Filter and Random Background Buttons --}}
 <div class="background-controls">
 <button type="button" class="background-filter-btn btn-secondary">
 <i class="fas fa-search"></i> Filter by Skill
 </button>
 {{#unless characterData.background}}
 <button type="button" class="random-background-btn btn-secondary">
 <i class="fas fa-dice"></i> Random Background
 </button>
 {{/unless}}
 </div>

 {{!-- Homebrew Toggle for Planets --}}
 {{#if (eq characterData.backgroundCategory 'planets')}}
 <div class="homebrew-toggle-container">
 <label class="homebrew-toggle-label">
 <input type="checkbox" class="allow-homebrew-toggle" {{checked characterData.allowHomebrewPlanets}}>
 <i class="fas fa-flask"></i> <strong>Allow Homebrew Planets</strong>
 <span class="hint-text">Include additional planet options beyond core rulebook</span>
 </label>
 </div>
 {{/if}}

 {{!-- Background Cards Display --}}
 <div class="background-cards-container">
 {{#if characterData.background}}
 {{!-- Selected Background Display --}}
 <div class="selected-background-display">
 <div class="selected-background-header">
 <h4>✓ Selected: {{characterData.background.name}}</h4>
 <span class="background-icon-large">{{characterData.background.icon}}</span>
 </div>
 <div class="selected-background-details">
 <p class="background-narrative">{{characterData.background.narrativeDescription}}</p>
 <div class="background-benefits">
 <strong>Benefits:</strong>
 <ul>
 {{#if characterData.background.specialAbility}}
 <li><strong>Special:</strong> {{characterData.background.specialAbility}}</li>
 {{/if}}
 {{#if characterData.backgroundSkills}}
 <li><strong>Class Skills Added:</strong> {{#each characterData.backgroundSkills}}{{this.display}}{{#unless @last}}, {{/unless}}{{/each}}</li>
 {{/if}}
 {{#if characterData.background.bonusLanguage}}
 <li><strong>Language:</strong> {{characterData.background.bonusLanguage}}</li>
 {{/if}}
 </ul>
 </div>
 <button type="button" class="change-background-btn btn-secondary">
 <i class="fas fa-undo"></i> Change Background
 </button>
 </div>
 </div>
 {{else}}
 {{!-- Background Selection Grid --}}
 <div class="background-selection-grid" id="background-selection-grid">
 {{!-- Cards will be populated by JavaScript based on selected category --}}
 <p class="loading-backgrounds">Loading backgrounds...</p>
 </div>
 {{/if}}
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 {{#if characterData.background}}
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 {{/if}}
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "abilities")}}
 <section class="step-abilities">
 <h3>Generate Ability Scores</h3>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 <div class="ability-header">
 <button type="button" id="free-build-btn" class="free-build-button">
 <i class="fas fa-edit"></i> Free Build (Manual Entry)
 </button>
 <p class="method-hint">GM's Setting: <strong>{{methodLabels.[abilityMethod]}}</strong></p>
 </div>
 <div class="ability-methods">
 <button type="button" id="pb-init" class="method-button">
 <i class="fas fa-calculator"></i> Point Buy ({{pointBuyPool}} points)
 </button>
 <button type="button" id="std-roll-btn" class="method-button">
 <i class="fas fa-dice"></i> Standard Roll (4d6 drop lowest)
 </button>
 <button type="button" id="org-roll-btn" class="method-button">
 <i class="fas fa-dice-d20"></i> Organic Roll (24d6)
 </button>
 </div>

 <div id="point-mode" class="ability-mode">
 <div class="points-remaining">
 Points Remaining: <strong><span id="point-remaining">32</span></strong>
 </div>
 <div class="abilities-grid">
 {{#each characterData.abilities}}
 <div class="ability-card">
 <label>{{@key}}</label>
 <div class="ability-controls">
 <button type="button" class="ability-btn" data-minus="{{@key}}">−</button>
 <input name="ability_{{@key}}" class="ability-input" type="number" value="{{this.base}}" min="8" max="18" />
 <button type="button" class="ability-btn" data-plus="{{@key}}">+</button>
 </div>
 <div class="ability-breakdown">
{{#if this.racial}}
<span class="racial-bonus">Racial: {{#if (gte this.racial 0)}}+{{/if}}{{this.racial}}</span>
{{/if}}
<div id="display_{{@key}}" class="ability-display">Total: {{this.total}} (Mod: {{#if (gte this.mod 0)}}+{{/if}}{{this.mod}})</div>
</div>
 </div>
 {{/each}}
 </div>
 </div>

 <div id="standard-mode" class="ability-mode" style="display:none;">
 <div id="roll-results" class="roll-results"></div>
 <p class="hint">Click a roll value, then click an ability to assign it.</p>
 </div>

 <div id="organic-mode" class="ability-mode" style="display:none;">
 <div id="organic-groups" class="organic-groups"></div>
 <p class="hint">Click a group, then click an ability to assign the total.</p>
 </div>

 <div id="free-mode" class="ability-mode" style="display:none;">
 <p class="hint">Manually enter any ability score values (3-25).</p>
 <div class="abilities-grid">
 {{#each characterData.abilities}}
 <div class="ability-card">
 <label>{{@key}}</label>
 <input name="ability_{{@key}}" class="ability-input free-input" type="number" value="10" min="3" max="25" />
 <div class="ability-breakdown">
{{#if this.racial}}
<span class="racial-bonus">Racial: {{#if (gte this.racial 0)}}+{{/if}}{{this.racial}}</span>
{{/if}}
<div id="display_{{@key}}" class="ability-display">Total: {{this.total}} (Mod: {{#if (gte this.mod 0)}}+{{/if}}{{this.mod}})</div>
</div>
 </div>
 {{/each}}
 </div>
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "class")}}
 <section class="step-class">
 <header class="creator-header">
 <h1><i class="fas fa-star"></i> Choose Your Path</h1>
 <p class="subtitle">Select your character's class</p>
 {{#if characterData.classes}}
 {{#if (gt characterData.classes.length 0)}}
 <div class="selected-class-display">
 <strong>Selected: {{characterData.classes.[0].name}}</strong>
 </div>
 {{/if}}
 {{/if}}
 </header>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 <div class="class-grid">
 {{#each packs.classes}}
 <div class="class-choice-btn {{#if (eq this.name ../characterData.classes.[0].name)}}selected{{/if}}" data-class="{{this.name}}">
 <div class="class-icon">
 <i class="fas {{this.icon}}"></i>
 </div>
 <h3>{{this.name}}</h3>
 <p class="class-desc">{{this.description}}</p>
 <div class="class-stats">
 <span>Hit Die: {{this.displayHitDie}}</span>
 <span>{{this.displayBAB}}</span>
 </div>
 <div class="select-overlay">
 <span>Select {{this.name}}</span>
 </div>
 </div>
 {{/each}}
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 {{#if (gt characterData.classes.length 0)}}
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 {{/if}}
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "feats")}}
 <section class="step-feats">
 <h3>Select Starting Feat{{#if (gt characterData.featsRequired 1)}}s{{/if}}</h3>
 <p class="help-text">All characters gain 1 general feat at 1st level.{{#if (gt characterData.featsRequired 1)}} Humans gain 1 bonus feat.{{/if}}</p>

 <div class="selected-feats-summary">
 <h4>Selected Feats ({{characterData.feats.length}}/{{characterData.featsRequired}})</h4>
 <div class="selected-feats-list">
 {{#each characterData.feats}}
 <div class="selected-feat-badge">
 <span>{{this.name}}</span>
 <button type="button" class="remove-feat" data-featid="{{this._id}}">×</button>
 </div>
 {{/each}}
 </div>
 </div>

 {{#if featCategories}}
 <div class="feats-categorized">
 {{#each featCategoryList}}
 {{#with (lookup ../featCategories this.key)}}
 {{#if (gt this.feats.length 0)}}
 <div class="feat-category">
 <h4 class="category-header">
 <span class="category-icon">{{../icon}}</span>
 {{../name}}
 <span class="feat-count">({{this.feats.length}})</span>
 </h4>
 <p class="category-description">{{../description}}</p>
 <div class="feats-grid">
 {{#each this.feats}}
 <div class="feat-card feat-with-tooltip {{#if this.indentLevel}}feat-indent-{{this.indentLevel}}{{/if}} {{#if this.featLevel}}feat-level-{{this.featLevel}}{{/if}} {{#if this.isSuggested}}is-suggested {{this.suggestion.cssClass}}{{/if}} {{#unless this.isQualified}}unqualified{{/unless}}" data-tooltip="{{this.system.benefit}}" data-indent-level="{{this.indentLevel}}" {{#if this.suggestion}}data-suggestion-tier="{{this.suggestion.tier}}"{{/if}}>
 <button type="button" class="select-feat choice-button" data-featid="{{this._id}}" {{#unless this.isQualified}}disabled{{/unless}}>
 {{#if this.suggestion.iconClass}}
 <span class="feat-suggestion-badge {{this.suggestion.cssClass}}" title="{{this.suggestion.reason}}">
 <i class="{{this.suggestion.iconClass}}"></i>
 </span>
 {{/if}}
 <h5>{{this.name}}</h5>
 {{#if this.system.prerequisites}}
 <p class="feat-prereqs"><em>Prerequisites: {{this.system.prerequisites}}</em></p>
 {{/if}}
 {{#if this.suggestion.reason}}
 <p class="suggestion-reason">{{this.suggestion.reason}}</p>
 {{/if}}
 {{#if this.metadata.chain}}
 <span class="feat-chain-badge">{{this.metadata.chain}}</span>
 {{/if}}
 </button>
 </div>
 {{/each}}
 </div>
 </div>
 {{/if}}
 {{/with}}
 {{/each}}
 </div>
 {{else}}
 <div class="feats-list">
 {{#each packs.feats}}
 <div class="feat-item feat-with-tooltip {{#if this.indentLevel}}feat-indent-{{this.indentLevel}}{{/if}} {{#if this.featLevel}}feat-level-{{this.featLevel}}{{/if}} {{#if this.isSuggested}}is-suggested {{this.suggestion.cssClass}}{{/if}} {{#unless this.isQualified}}unqualified{{/unless}}" data-tooltip="{{this.system.benefit}}" data-indent-level="{{this.indentLevel}}" {{#if this.suggestion}}data-suggestion-tier="{{this.suggestion.tier}}"{{/if}}>
 <button type="button" class="select-feat choice-button" data-featid="{{this._id}}" {{#unless this.isQualified}}disabled{{/unless}}>
 {{#if this.suggestion.iconClass}}
 <span class="feat-suggestion-badge {{this.suggestion.cssClass}}" title="{{this.suggestion.reason}}">
 <i class="{{this.suggestion.iconClass}}"></i>
 </span>
 {{/if}}
 <h4>{{this.name}}</h4>
 {{#if this.system.prerequisites}}
 <p class="feat-prereqs"><strong>Prerequisites:</strong> {{this.system.prerequisites}}</p>
 {{/if}}
 {{#if this.suggestion.reason}}
 <p class="suggestion-reason">{{this.suggestion.reason}}</p>
 {{/if}}
 </button>
 </div>
 {{/each}}
 </div>
 {{/if}}

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 {{#if (gte characterData.feats.length characterData.featsRequired)}}
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 {{/if}}
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "talents")}}
 <section class="step-talents">
 {{#unless selectedTalentTree}}
 {{!-- Step 1: Select Talent Tree --}}
 <h3>Select a Talent Tree</h3>
 <p class="help-text">Choose a talent tree from your class. Then select a talent from that tree.</p>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 {{#if (gt availableTalentTrees.length 0)}}
 <div class="talent-trees-grid">
 {{#each availableTalentTrees}}
 <button type="button" class="select-talent-tree choice-button" data-tree="{{this}}">
 <h4>{{this}}</h4>
 <p>Click to view talents in this tree</p>
 </button>
 {{/each}}
 </div>
 {{else}}
 <div class="no-talent-trees">
 <p>No talent trees available for your selected class.</p>
 </div>
 {{/if}}

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 </div>
 {{else}}
 {{!-- Step 2: Select Talent from Tree --}}
 <h3>Select Talent from {{selectedTalentTree}}</h3>
 <p class="help-text">Choose a talent from the {{selectedTalentTree}} tree.</p>

 <div class="talents-list">
 {{#each packs.talentsInTree}}
 <div class="talent-item {{#if this.isSuggested}}is-suggested {{this.suggestion.cssClass}}{{/if}} {{#unless this.isQualified}}unqualified{{/unless}}" {{#if this.suggestion}}data-suggestion-tier="{{this.suggestion.tier}}"{{/if}}>
 <button type="button" class="select-talent choice-button" data-talentid="{{this._id}}" {{#unless this.isQualified}}disabled{{/unless}}>
 {{#if this.suggestion.iconClass}}
 <span class="talent-suggestion-badge {{this.suggestion.cssClass}}" title="{{this.suggestion.reason}}">
 <i class="{{this.suggestion.iconClass}}"></i>
 </span>
 {{/if}}
 <h4>{{this.name}}</h4>
 {{#if this.system.description}}
 <p class="talent-description">{{this.system.description}}</p>
 {{/if}}
 {{#if this.system.prerequisites}}
 <p class="talent-prereqs"><em>Prerequisites: {{this.system.prerequisites}}</em></p>
 {{/if}}
 {{#if this.suggestion.reason}}
 <p class="suggestion-reason">{{this.suggestion.reason}}</p>
 {{/if}}
 </button>
 </div>
 {{/each}}
 </div>

 <div class="form-actions">
 <button type="button" class="back-to-talent-trees btn-secondary">
 <i class="fas fa-arrow-left"></i> Back to Talent Trees
 </button>
 </div>
 {{/unless}}
 </section>
 {{/if}}

 {{#if (eq currentStep "force-powers")}}
 <section class="step-force-powers">
 <h3>Select Force Power{{#if (gt characterData.forcePowersRequired 1)}}s{{/if}}</h3>
 <p class="help-text">
 {{#if (eq characterData.forcePowersRequired 1)}}
 Force Sensitivity grants you 1 force power.
 {{else}}
 Select {{characterData.forcePowersRequired}} force power(s) from your Force Sensitivity and Force Training feats.
 {{/if}}
 </p>

 <div class="selected-powers-summary">
 <h4>Selected Force Powers ({{characterData.powers.length}}/{{characterData.forcePowersRequired}})</h4>
 <div class="selected-powers-list">
 {{#each characterData.powers}}
 <div class="selected-power-badge">
 <span>{{this.name}}</span>
 <button type="button" class="remove-power" data-powerid="{{this._id}}">×</button>
 </div>
 {{/each}}
 </div>
 </div>

 <div class="force-powers-list">
 {{#each availableForcePowers}}
 <div class="power-item power-with-tooltip" data-tooltip="{{this.system.description}}">
 <button type="button" class="select-power choice-button" data-powerid="{{this._id}}">
 <h4>{{this.name}}</h4>
 {{#if this.system.powerLevel}}
 <p class="power-level"><strong>Power Level:</strong> {{this.system.powerLevel}}</p>
 {{/if}}
 {{#if this.system.prerequisites}}
 <p class="power-prereqs"><em>Prerequisites: {{this.system.prerequisites}}</em></p>
 {{/if}}
 </button>
 </div>
 {{/each}}
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 {{#if (gte characterData.powers.length characterData.forcePowersRequired)}}
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 {{/if}}
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "starship-maneuvers")}}
 <section class="step-starship-maneuvers">
 <h3>Select Starship Maneuver{{#if (gt characterData.starshipManeuversRequired 1)}}s{{/if}}</h3>
 <p class="help-text">
 {{#if (eq characterData.starshipManeuversRequired 1)}}
 Starship Tactics grants you 1 starship maneuver.
 {{else}}
 Select {{characterData.starshipManeuversRequired}} starship maneuver(s) from your Starship Tactics feat.
 {{/if}}
 </p>

 <div class="selected-maneuvers-summary">
 <h4>Selected Starship Maneuvers ({{characterData.starshipManeuvers.length}}/{{characterData.starshipManeuversRequired}})</h4>
 <div class="selected-maneuvers-list">
 {{#each characterData.starshipManeuvers}}
 <div class="selected-maneuver-badge">
 <span>{{this.name}}</span>
 <button type="button" class="remove-maneuver" data-maneuverid="{{this.name}}">×</button>
 </div>
 {{/each}}
 </div>
 </div>

 <div class="maneuvers-list">
 {{#each availableStarshipManeuvers}}
 <div class="maneuver-item maneuver-with-tooltip {{#unless this.prerequisitesMet}}disabled{{/unless}}" data-tooltip="{{this.description}}">
 <button type="button" class="select-maneuver choice-button {{#unless this.prerequisitesMet}}disabled{{/unless}}" data-maneuverid="{{this.name}}" {{#unless this.prerequisitesMet}}disabled{{/unless}}>
 <h4>{{this.name}}</h4>
 {{#if this.actionType}}
 <p class="maneuver-action"><strong>Action:</strong> {{this.actionType}}</p>
 {{/if}}
 {{#if this.prerequisiteReasons.length}}
 <p class="maneuver-prereqs"><em style="color: #d32f2f;">{{#each this.prerequisiteReasons}}{{this}}{{#unless @last}}<br/>{{/unless}}{{/each}}</em></p>
 {{/if}}
 </button>
 </div>
 {{/each}}
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 {{#if (gte characterData.starshipManeuvers.length characterData.starshipManeuversRequired)}}
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 {{/if}}
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "skills")}}
 <section class="step-skills">
 <h3>Select Trained Skills</h3>
 <p class="help-text">Select {{characterData.trainedSkillsAllowed}} class skills to train. Training grants +5 bonus.</p>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 <div class="skills-summary" style="margin-bottom: 1rem;">
 <p><strong>Trained Skills: {{characterData.trainedSkillsCount}} / {{characterData.trainedSkillsAllowed}}</strong></p>
 <button type="button" class="reset-skills-btn btn-secondary" style="margin-left: 1rem;">
 <i class="fas fa-redo"></i> Reset All
 </button>
 </div>

 <div class="skills-list-chargen">
 {{#each availableSkills}}
 {{#if this.isClassSkill}}
 <div class="skill-row-chargen {{#if this.trained}}trained{{/if}} {{#if this.isSuggested}}is-suggested {{this.suggestion.cssClass}}{{/if}}" {{#if this.suggestion}}data-suggestion-tier="{{this.suggestion.tier}}"{{/if}}>
 <div class="skill-checkbox">
 <input type="checkbox"
 class="skill-select"
 data-skill="{{this.key}}"
 {{checked this.trained}}
 {{#if (and (not this.trained) (gte ../characterData.trainedSkillsCount ../characterData.trainedSkillsAllowed))}}disabled{{/if}}/>
 </div>
 <div class="skill-name-col">
 {{#if this.suggestion.iconClass}}
 <span class="skill-suggestion-badge {{this.suggestion.cssClass}}" title="{{this.suggestion.reason}}">
 <i class="{{this.suggestion.iconClass}}"></i>
 </span>
 {{/if}}
 <strong>{{this.name}}</strong>
 <span class="skill-ability-label">({{uppercase this.ability}})</span>
 {{#if this.suggestion.reason}}
 <p class="suggestion-reason" style="margin-top: 0.5rem; font-size: 0.9rem;">{{this.suggestion.reason}}</p>
 {{/if}}
 </div>
 <div class="skill-bonus-col">
 {{#if this.trained}}
 <span class="current-bonus">+{{this.currentBonus}}</span>
 <span class="bonus-breakdown">= ½lvl({{this.halfLevel}}) + {{uppercase this.ability}}({{formatBonus this.abilityMod}}) + trained(+5)</span>
 {{else}}
 <span class="current-bonus untrained">+{{this.currentBonus}}</span>
 <span class="if-trained-preview">→ +{{this.trainedBonus}} if trained</span>
 {{/if}}
 </div>
 </div>
 {{/if}}
 {{/each}}
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 {{#if (gte characterData.trainedSkillsCount characterData.trainedSkillsAllowed)}}
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 {{/if}}
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "languages")}}
 <section class="step-languages">
 <h3>Select Languages</h3>
 <p class="help-text">Choose additional languages your character knows based on Intelligence.</p>

 {{#if characterData.languageData}}
 {{!-- Language Counter --}}
 <div class="language-counter-box">
 {{#if (gt characterData.languageData.additional 0)}}
 <div class="counter-display">
 <i class="fas fa-language"></i>
 <span class="counter-text">Languages Remaining:</span>
 <span class="counter-value">{{subtract (add characterData.languageData.granted.length characterData.languageData.additional) characterData.languages.length}}</span>
 /
 <span class="counter-total">{{characterData.languageData.additional}}</span>
 </div>
 {{else}}
 <div class="no-additional-languages">
 <i class="fas fa-info-circle"></i>
 <span>You have no additional languages to select (Intelligence modifier: {{characterData.languageData.additional}})</span>
 </div>
 {{/if}}
 </div>

 {{!-- Automatic/Granted Languages Section --}}
 <div class="granted-languages-section">
 <h4><i class="fas fa-gift"></i> Automatic Languages</h4>
 <p class="section-description">These languages are automatically granted by your species.</p>
 <div class="granted-languages-list">
 {{#each characterData.languageData.granted}}
 <div class="language-item granted">
 <i class="fas fa-check-circle"></i>
 <span class="language-name">{{this}}</span>
 <span class="language-badge">Granted</span>
 </div>
 {{/each}}
 </div>
 {{#if (gt characterData.languageData.understands.length 0)}}
 <div class="understands-languages">
 <p><i class="fas fa-ear-listen"></i> <strong>Understands Only:</strong> {{#each characterData.languageData.understands}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}</p>
 </div>
 {{/if}}
 </div>

 {{!-- Selected Additional Languages --}}
 {{#if (gt characterData.languageData.additional 0)}}
 <div class="selected-additional-languages-section">
 <h4><i class="fas fa-star"></i> Selected Additional Languages</h4>
 {{#each characterData.languages}}
 {{#unless (contains ../characterData.languageData.granted this)}}
 <div class="language-item selected">
 <i class="fas fa-check-circle"></i>
 <span class="language-name">{{this}}</span>
 <button type="button" class="remove-language" data-language="{{this}}" title="Remove language">
 <i class="fas fa-times"></i>
 </button>
 </div>
 {{/unless}}
 {{/each}}
 {{#if (eq (subtract characterData.languages.length characterData.languageData.granted.length) 0)}}
 <p class="no-selection-yet">No additional languages selected yet.</p>
 {{/if}}
 </div>

 {{!-- Available Languages to Choose --}}
 <div class="available-languages-section">
 <h4><i class="fas fa-globe"></i> Available Languages</h4>

 {{!-- Widely Used Languages First --}}
 {{#if languageCategories.widelyUsed}}
 <div class="language-category">
 <h5 class="category-name">
 <i class="fas fa-star"></i> {{languageCategories.widelyUsed.name}}
 </h5>
 <p class="category-description">{{languageCategories.widelyUsed.description}}</p>
 <div class="languages-grid">
 {{#each languageCategories.widelyUsed.languages}}
 {{#unless (contains ../../characterData.languages this)}}
 <button
 type="button"
 class="select-language language-button"
 data-language="{{this}}">
 {{this}}
 </button>
 {{/unless}}
 {{/each}}
 </div>
 </div>
 {{/if}}

 {{!-- Local/Trade Languages Second --}}
 {{#if languageCategories.localTrade}}
 <div class="language-category">
 <h5 class="category-name">
 <i class="fas fa-map-marked-alt"></i> {{languageCategories.localTrade.name}}
 </h5>
 <p class="category-description">{{languageCategories.localTrade.description}}</p>
 <div class="languages-grid">
 {{#each languageCategories.localTrade.languages}}
 {{#unless (contains ../../characterData.languages this)}}
 <button
 type="button"
 class="select-language language-button"
 data-language="{{this}}">
 {{this}}
 </button>
 {{/unless}}
 {{/each}}
 </div>
 </div>
 {{/if}}

 {{!-- Add Custom Language Button --}}
 <div class="custom-language-section">
 <button type="button" class="add-custom-language-btn btn-custom">
 <i class="fas fa-plus-circle"></i> Add Custom Language
 </button>
 <p class="custom-language-hint">Create your own language for homebrew campaigns or unique backgrounds</p>
 </div>
 </div>
 {{/if}}
 {{/if}}

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 <button type="button" class="next-step btn-primary">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 </div>
 </section>
 {{/if}}

 {{#if (eq currentStep "droid-final")}}
 <section class="step-droid-final holo-shop">
 {{!-- Header --}}
 <div class="holo-banner">
 <div class="holo-speaker">
 <i class="fas fa-microchip"></i>
 <span class="speaker-name">FINAL DROID CUSTOMIZATION:</span>
 </div>
 <div class="holo-message">
 "Now that you've selected your class and background, here's your final credit total! Customize your droid with your complete budget."
 </div>
 </div>

 {{!-- Credits including class/background bonuses --}}
 <div class="credit-wallet final-credits-wallet">
 <div class="wallet-header">
 <i class="fas fa-wallet"></i>
 <span>FINAL CREDIT ALLOCATION</span>
 </div>
 <div class="wallet-amount">
 <span class="credits-icon">₢</span>
 <span class="remaining-credits {{#if (lt characterData.droidCredits.remaining 0)}}overbudget{{/if}}">{{characterData.droidCredits.remaining}}</span>
 <span class="credits-label">credits</span>
 </div>
 <div class="wallet-details">
 <div class="wallet-detail-item">
 <span class="detail-label">Total Budget:</span>
 <span class="base-credits">{{characterData.droidCredits.base}}</span> cr
 </div>
 <div class="wallet-detail-item">
 <span class="detail-label">Spent:</span>
 <span class="spent-credits">{{characterData.droidSystems.totalCost}}</span> cr
 </div>
 <div class="wallet-detail-item">
 <span class="detail-label">Remaining:</span>
 <span class="remaining-credits {{#if (lt characterData.droidCredits.remaining 0)}}overbudget{{/if}}">{{characterData.droidCredits.remaining}}</span> cr
 </div>
 </div>
 </div>

 {{!-- Droid Builder Interface (reuse same UI) --}}
 <div id="droid-final-builder" class="holo-datapad">
 <nav class="shop-tabs">
 <button type="button" class="shop-tab active" data-tab="locomotion"><i class="fas fa-shoe-prints"></i> Locomotion</button>
 <button type="button" class="shop-tab" data-tab="processor"><i class="fas fa-microchip"></i> Processors</button>
 <button type="button" class="shop-tab" data-tab="appendages"><i class="fas fa-hand-paper"></i> Appendages</button>
 <button type="button" class="shop-tab" data-tab="accessories"><i class="fas fa-tools"></i> Accessories</button>
 <button type="button" class="shop-tab cart-tab" data-tab="cart"><i class="fas fa-shopping-cart"></i> Cart</button>
 </nav>
 <div class="shop-content">
 <div class="shop-panel active" data-panel="locomotion"><div id="locomotion-list" class="product-grid"></div></div>
 <div class="shop-panel" data-panel="processor"><div id="processor-list" class="product-grid"></div></div>
 <div class="shop-panel" data-panel="appendages"><div id="appendages-list" class="product-grid"></div></div>
 <div class="shop-panel" data-panel="accessories">
 <nav class="accessory-tabs">
 <button type="button" class="accessory-tab active" data-accessorytab="armor"><i class="fas fa-shield-alt"></i> Armor</button>
 <button type="button" class="accessory-tab" data-accessorytab="communications"><i class="fas fa-broadcast-tower"></i> Comms</button>
 <button type="button" class="accessory-tab" data-accessorytab="sensors"><i class="fas fa-radar"></i> Sensors</button>
 <button type="button" class="accessory-tab" data-accessorytab="shields"><i class="fas fa-shield-halved"></i> Shields</button>
 <button type="button" class="accessory-tab" data-accessorytab="translators"><i class="fas fa-language"></i> Translators</button>
 <button type="button" class="accessory-tab" data-accessorytab="miscellaneous"><i class="fas fa-box"></i> Misc</button>
 </nav>
 <div class="accessory-content">
 <div class="accessory-panel active" data-accessory-panel="armor"><div id="accessories-armor" class="product-grid"></div></div>
 <div class="accessory-panel" data-accessory-panel="communications"><div id="accessories-communications" class="product-grid"></div></div>
 <div class="accessory-panel" data-accessory-panel="sensors"><div id="accessories-sensors" class="product-grid"></div></div>
 <div class="accessory-panel" data-accessory-panel="shields"><div id="accessories-shields" class="product-grid"></div></div>
 <div class="accessory-panel" data-accessory-panel="translators"><div id="accessories-translators" class="product-grid"></div></div>
 <div class="accessory-panel" data-accessory-panel="miscellaneous"><div id="accessories-miscellaneous" class="product-grid"></div></div>
 </div>
 </div>
 <div class="shop-panel cart-panel" data-panel="cart">
 <div class="cart-validation" id="cart-validation"></div>
 <div class="cart-items" id="cart-items-list"></div>
 </div>
 </div>
 </div>
 </section>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 <button type="button" class="next-step btn-primary" id="droid-final-next">
 Next <i class="fas fa-arrow-right"></i>
 </button>
 </div>
 {{/if}}

 {{#if (eq currentStep "summary")}}
 <section class="step-summary">
 <h3><i class="fas fa-scroll"></i> Character Summary</h3>
 <p class="summary-intro">Review your character before finalizing. Click "Create Character" to proceed to equipment shopping.</p>

 {{#if narratorComment}}
 <div class="narrator-comment">
 <div class="narrator-avatar">
 <img src="systems/foundryvtt-swse/assets/mentors/salty.webp" alt="Ol' Salty" />
 </div>
 <div class="narrator-speech-bubble">
 <p><strong>Ol' Salty:</strong> {{narratorComment}}</p>
 </div>
 </div>
 {{/if}}

 <div class="summary-grid">
 {{!-- Basic Information --}}
 <div class="summary-card">
 <h4><i class="fas fa-user"></i> Basic Information</h4>
 <dl class="summary-list">
 <dt>Name:</dt>
 <dd><strong>{{characterData.name}}</strong></dd>
 {{#if characterData.isDroid}}
 <dt>Type:</dt>
 <dd>Droid ({{characterData.droidDegree}})</dd>
 {{else}}
 <dt>Species:</dt>
 <dd>{{characterData.species}}</dd>
 {{/if}}
 <dt>Size:</dt>
 <dd>{{characterData.size}}</dd>
 <dt>Level:</dt>
 <dd>{{characterData.level}}</dd>
 </dl>
 </div>

 {{!-- Classes --}}
 <div class="summary-card">
 <h4><i class="fas fa-graduation-cap"></i> Classes</h4>
 <ul class="summary-list-items">
 {{#each characterData.classes}}
 <li><strong>{{this.name}}</strong> (Level {{this.level}})</li>
 {{/each}}
 </ul>
 </div>

 {{!-- Ability Scores --}}
 <div class="summary-card">
 <h4><i class="fas fa-chart-line"></i> Ability Scores</h4>
 <div class="abilities-grid">
 {{#each characterData.abilities}}
 <div class="ability-box">
 <span class="ability-label">{{uppercase @key}}</span>
 <span class="ability-score">{{this.total}}</span>
 <span class="ability-modifier">{{#if (gte this.mod 0)}}+{{/if}}{{this.mod}}</span>
 </div>
 {{/each}}
 </div>
 </div>

 {{!-- Languages --}}
 {{#if characterData.languages}}
 <div class="summary-card">
 <h4><i class="fas fa-language"></i> Languages</h4>
 <div class="language-chips">
 {{#each characterData.languages}}
 <span class="language-chip">{{this}}</span>
 {{/each}}
 </div>
 </div>
 {{/if}}

 {{!-- Trained Skills --}}
 <div class="summary-card">
 <h4><i class="fas fa-tools"></i> Trained Skills</h4>
 <ul class="summary-list-items">
 {{#each characterData.skills}}
 {{#if this.trained}}
 <li>{{@key}}</li>
 {{/if}}
 {{/each}}
 {{#unless characterData.trainedSkillsCount}}
 <li class="no-items">No skills trained yet</li>
 {{/unless}}
 </ul>
 </div>

 {{!-- Feats --}}
 <div class="summary-card">
 <h4><i class="fas fa-award"></i> Feats ({{characterData.feats.length}})</h4>
 <ul class="summary-list-items">
 {{#each characterData.feats}}
 <li>{{this.name}}</li>
 {{/each}}
 {{#unless characterData.feats.length}}
 <li class="no-items">No feats selected yet</li>
 {{/unless}}
 </ul>
 </div>

 {{!-- Talents --}}
 {{#if characterData.talents}}
 <div class="summary-card">
 <h4><i class="fas fa-star"></i> Talents ({{characterData.talents.length}})</h4>
 <ul class="summary-list-items">
 {{#each characterData.talents}}
 <li>{{this.name}}</li>
 {{/each}}
 {{#unless characterData.talents.length}}
 <li class="no-items">No talents selected yet</li>
 {{/unless}}
 </ul>
 </div>
 {{/if}}

 {{!-- Defense Stats --}}
 <div class="summary-card">
 <h4><i class="fas fa-shield-alt"></i> Defenses</h4>
 <dl class="summary-list">
 <dt>Fortitude:</dt>
 <dd>{{characterData.defenses.fort.total}}</dd>
 <dt>Reflex:</dt>
 <dd>{{characterData.defenses.reflex.total}}</dd>
 <dt>Will:</dt>
 <dd>{{characterData.defenses.will.total}}</dd>
 </dl>
 </div>

 {{!-- Combat Stats --}}
 <div class="summary-card">
 <h4><i class="fas fa-crosshairs"></i> Combat Stats</h4>
 <dl class="summary-list">
 <dt>Hit Points:</dt>
 <dd>{{characterData.hp.max}}</dd>
 <dt>Base Attack Bonus:</dt>
 <dd>+{{characterData.bab}}</dd>
 <dt>Speed:</dt>
 <dd>{{characterData.speed}} squares</dd>
 <dt>Damage Threshold:</dt>
 <dd>{{characterData.damageThreshold}}</dd>
 </dl>
 </div>
 </div>

 <div class="summary-confirmation">
 <div class="confirmation-box">
 <i class="fas fa-check-circle"></i>
 <p><strong>Ready to create your character?</strong></p>
 <p>Once created, you'll be able to shop for equipment with your starting {{characterData.credits}} credits.</p>
 </div>
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Previous
 </button>
 <button type="button" class="next-step btn-primary">
 <i class="fas fa-check"></i> Create Character & Shop
 </button>
 </div>
 </section>
 {{/if}}

 {{!-- Shop Step --}}
 {{#if (eq currentStep "shop")}}
 <section class="step-shop">
 {{!-- Holographic Welcome Banner --}}
 <div class="holo-banner">
 <div class="holo-speaker">
 <i class="fas fa-volume-up"></i>
 <span class="speaker-name">RENDARR:</span>
 </div>
 <div class="holo-message">
 "Welcome to my shop, lad! Spend to your heart's desire!"
 </div>
 </div>

 <div class="shop-intro">
 <p>Your character has been created! Now you can spend your starting credits on equipment, weapons, and gear.</p>
 <p class="credits-available">
 <i class="fas fa-wallet"></i>
 <strong>Available Credits:</strong> <span class="credits-value">{{characterData.credits}}</span> cr
 </p>
 </div>

 <div class="shop-options">
 <div class="shop-option-card">
 <i class="fas fa-store"></i>
 <h4>Browse the Marketplace</h4>
 <p>Purchase weapons, armor, equipment, and more from the Galactic Trade Exchange.</p>
 <button type="button" class="open-shop-btn btn-primary">
 <i class="fas fa-shopping-cart"></i> Open Shop
 </button>
 </div>

 <div class="shop-option-card">
 <i class="fas fa-forward"></i>
 <h4>Skip for Now</h4>
 <p>You can always access the shop later from your character sheet.</p>
 <button type="button" class="finish btn-secondary">
 <i class="fas fa-check"></i> Complete Character Creation
 </button>
 </div>
 </div>

 <div class="form-actions">
 <button type="button" class="prev-step btn-secondary">
 <i class="fas fa-arrow-left"></i> Back to Summary
 </button>
 </div>
 </section>
 {{/if}}
 </main>
</div>

<style>
.chargen-app {
 font-family: "Roboto", Arial, sans-serif;
 background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
 color: #e4e4e4;
 border-radius: 8px;
 overflow: hidden;
 display: flex;
 flex-direction: column;
 height: 100%;
}

.chargen-header {
 background: rgba(0, 0, 0, 0.3);
 padding: 1.5rem;
 border-bottom: 2px solid #0a74da;
 text-align: center;
}

.chargen-header h2 {
 margin: 0 0 0.5rem 0;
 color: #0a74da;
}

.step-indicator {
 font-size: 0.9rem;
 color: #aaa;
}

.chargen-body {
 padding: 2rem;
 min-height: 0;
 flex: 1;
 overflow-y: auto;
 overflow-x: hidden;
}

.form-group {
 margin-bottom: 1.5rem;
}

.form-group label {
 display: block;
 margin-bottom: 0.5rem;
 font-weight: bold;
 color: #0a74da;
}

.chargen-name-input {
 width: 100%;
 padding: 0.75rem;
 font-size: 1.1rem;
 border: 2px solid #0a74da;
 border-radius: 4px;
 background: rgba(255, 255, 255, 0.1);
 color: #fff;
}

.chargen-name-input:focus {
 outline: none;
 box-shadow: 0 0 10px rgba(10, 116, 218, 0.5);
}

.chargen-level-input {
 width: 100px;
 padding: 0.75rem;
 font-size: 1.1rem;
 border: 2px solid #0a74da;
 border-radius: 4px;
 background: rgba(255, 255, 255, 0.1);
 color: #fff;
 text-align: center;
}

.chargen-level-input:focus {
 outline: none;
 box-shadow: 0 0 10px rgba(10, 116, 218, 0.5);
}

.level-selector {
 display: flex;
 align-items: center;
 gap: 1rem;
}

.level-hint {
 font-size: 0.85rem;
 color: #aaa;
 font-style: italic;
}

.form-actions {
 display: flex;
 justify-content: space-between;
 margin-top: 2rem;
 gap: 1rem;
}

.btn-primary, .btn-secondary {
 padding: 0.75rem 1.5rem;
 font-size: 1rem;
 font-weight: bold;
 border: none;
 border-radius: 4px;
 cursor: pointer;
 transition: all 0.3s;
}

.btn-primary {
 background: linear-gradient(135deg, #0a74da 0%, #0056b3 100%);
 color: white;
}

.btn-primary:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(10, 116, 218, 0.4);
}

.btn-secondary {
 background: linear-gradient(135deg, #555 0%, #333 100%);
 color: white;
}

.btn-secondary:hover {
 background: linear-gradient(135deg, #666 0%, #444 100%);
}

.type-grid {
 display: grid;
 grid-template-columns: repeat(2, 1fr);
 gap: 2rem;
 max-width: 600px;
 margin: 2rem auto;
}

.type-grid .choice-button {
 padding: 2rem;
 min-height: 150px;
 display: flex;
 flex-direction: column;
 align-items: center;
 justify-content: center;
 gap: 0.5rem;
}

.type-grid .choice-button i {
 font-size: 3rem;
 margin-bottom: 0.5rem;
}

.import-option {
 text-align: center;
 margin: 2rem 0;
 padding: 1.5rem;
 background: rgba(0, 217, 255, 0.1);
 border: 2px dashed #00d9ff;
 border-radius: 8px;
}

.import-option .import-droid-btn {
 padding: 1rem 2rem;
 font-size: 1.1rem;
 margin-bottom: 0.5rem;
}

.import-hint {
 margin: 0.5rem 0 0 0;
 font-size: 0.9rem;
 color: #aaa;
 font-style: italic;
}

.degree-grid {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
 gap: 1rem;
}

.degree-grid .choice-button {
 padding: 1.5rem;
 min-height: 160px;
 display: flex;
 flex-direction: column;
}

.degree-grid .bonuses {
 margin: 0.5rem 0;
 padding: 0.5rem;
 background: rgba(10, 116, 218, 0.2);
 border-radius: 4px;
 font-size: 0.9rem;
 font-weight: bold;
}

.degree-grid .description {
 margin-top: 0.5rem;
 font-size: 0.85rem;
 color: #aaa;
 font-style: italic;
}

.species-filters {
 background: rgba(0, 0, 0, 0.3);
 border: 2px solid rgba(10, 116, 218, 0.3);
 border-radius: 8px;
 padding: 1.5rem;
 margin-bottom: 2rem;
}

.species-filters .filter-header {
 display: flex;
 align-items: center;
 gap: 0.5rem;
 margin-bottom: 1rem;
 color: #0a74da;
 font-size: 1.1rem;
 font-weight: bold;
}

.species-filters .filter-header i {
 font-size: 1.2rem;
}

.species-filters .filter-controls {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
 gap: 1rem;
 align-items: end;
}

.species-filters .filter-group {
 display: flex;
 flex-direction: column;
 gap: 0.5rem;
}

.species-filters .filter-group label {
 color: #aaa;
 font-size: 0.9rem;
 font-weight: 600;
}

.species-filters .species-filter-select {
 padding: 0.5rem;
 background: rgba(255, 255, 255, 0.1);
 border: 2px solid #0a74da;
 border-radius: 4px;
 color: #fff;
 font-size: 0.95rem;
 cursor: pointer;
 transition: all 0.3s;
}

.species-filters .species-filter-select:hover {
 background: rgba(10, 116, 218, 0.2);
 border-color: #00d9ff;
}

.species-filters .species-filter-select:focus {
 outline: none;
 box-shadow: 0 0 10px rgba(10, 116, 218, 0.5);
}

.species-filters .clear-species-filters {
 padding: 0.5rem 1rem;
 width: 100%;
}

.species-grid, .class-grid {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
 gap: 1rem;
}

.choice-button {
 padding: 1rem;
 background: rgba(255, 255, 255, 0.05);
 border: 2px solid #0a74da;
 border-radius: 8px;
 color: #fff;
 cursor: pointer;
 transition: all 0.3s;
}

.choice-button:hover {
 background: rgba(10, 116, 218, 0.2);
 transform: translateY(-4px);
 box-shadow: 0 6px 16px rgba(10, 116, 218, 0.3);
}

.ability-header {
 display: flex;
 justify-content: space-between;
 align-items: center;
 margin-bottom: 1rem;
 padding: 1rem;
 background: rgba(0, 0, 0, 0.2);
 border-radius: 6px;
}

.free-build-button {
 padding: 0.75rem 1.5rem;
 background: linear-gradient(135deg, #00d9ff 0%, #0a74da 100%);
 border: none;
 border-radius: 4px;
 color: white;
 font-weight: bold;
 cursor: pointer;
 transition: all 0.3s;
}

.free-build-button:hover {
 transform: translateY(-2px);
 box-shadow: 0 4px 12px rgba(0, 217, 255, 0.4);
}

.method-hint {
 margin: 0;
 color: #aaa;
 font-size: 0.9rem;
}

.method-hint strong {
 color: #00d9ff;
}

.ability-methods {
 display: flex;
 gap: 1rem;
 margin-bottom: 1.5rem;
}

.method-button {
 flex: 1;
 padding: 0.75rem;
 background: rgba(255, 255, 255, 0.05);
 border: 2px solid #0a74da;
 border-radius: 6px;
 color: #fff;
 cursor: pointer;
 transition: all 0.3s;
}

.method-button:hover {
 background: rgba(10, 116, 218, 0.2);
 transform: translateY(-2px);
}

.abilities-grid {
 display: grid;
 grid-template-columns: repeat(3, 1fr);
 gap: 1rem;
}

.ability-card {
 background: rgba(255, 255, 255, 0.05);
 padding: 1rem;
 border-radius: 6px;
 border: 1px solid #0a74da;
}

.ability-controls {
 display: flex;
 align-items: center;
 gap: 0.5rem;
 margin: 0.5rem 0;
}

.ability-btn {
 width: 30px;
 height: 30px;
 background: #0a74da;
 border: none;
 border-radius: 4px;
 color: white;
 font-size: 1.2rem;
 cursor: pointer;
}

.ability-input {
 flex: 1;
 text-align: center;
 padding: 0.5rem;
 background: rgba(255, 255, 255, 0.1);
 border: 1px solid #0a74da;
 border-radius: 4px;
 color: #fff;
}

.ability-display {
 text-align: center;
 margin-top: 0.5rem;
 font-size: 0.9rem;
 color: #aaa;
}

/* Class Selection Styles */
.step-class .creator-header {
 text-align: center;
 padding: 1.5rem 2rem;
 background: linear-gradient(180deg, rgba(0, 0, 0, 0.3) 0%, transparent 100%);
 margin-bottom: 1rem;
}

.step-class .creator-header h1 {
 margin: 0 0 0.5rem 0;
 font-size: 2rem;
 color: #4a90e2;
 text-shadow: 0 0 15px rgba(74, 144, 226, 0.5);
}

.step-class .creator-header .subtitle {
 margin: 0;
 font-size: 1rem;
 color: #aaa;
 font-style: italic;
}

.step-class .selected-class-display {
 margin-top: 0.75rem;
 padding: 0.5rem;
 background: rgba(74, 144, 226, 0.2);
 border-radius: 4px;
 color: #4a90e2;
 font-size: 0.95rem;
}

.step-class .class-grid {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
 gap: 1.5rem;
 margin-bottom: 1.5rem;
}

.class-choice-btn {
 position: relative;
 background: linear-gradient(135deg, rgba(30, 30, 40, 0.9), rgba(20, 20, 30, 0.9));
 border: 3px solid #444;
 border-radius: 12px;
 padding: 2rem;
 cursor: pointer;
 transition: all 0.4s ease;
 overflow: hidden;
}

.class-choice-btn::before {
 content: '';
 position: absolute;
 top: 0;
 left: 0;
 right: 0;
 height: 4px;
 background: linear-gradient(90deg, #4a90e2, #357abd);
 transform: scaleX(0);
 transition: transform 0.4s ease;
}

.class-choice-btn:hover {
 border-color: #4a90e2;
 transform: translateY(-8px);
 box-shadow: 0 10px 30px rgba(74, 144, 226, 0.4);
}

.class-choice-btn:hover::before {
 transform: scaleX(1);
}

.class-choice-btn.selected {
 border-color: #4a90e2;
 background: linear-gradient(135deg, rgba(74, 144, 226, 0.3), rgba(53, 122, 189, 0.2));
}

.class-icon {
 font-size: 4rem;
 color: #4a90e2;
 margin-bottom: 1rem;
 text-align: center;
 transition: all 0.3s ease;
}

.class-choice-btn:hover .class-icon {
 transform: scale(1.1);
 text-shadow: 0 0 20px rgba(74, 144, 226, 0.8);
}

.class-choice-btn h3 {
 margin: 0 0 0.75rem 0;
 font-size: 1.8rem;
 color: #4a90e2;
 text-align: center;
 font-weight: bold;
}

.class-choice-btn .class-desc {
 margin: 0 0 1rem 0;
 color: #aaa;
 text-align: center;
 line-height: 1.5;
 font-size: 0.95rem;
}

.class-choice-btn .class-stats {
 display: flex;
 justify-content: space-around;
 gap: 1rem;
 margin-top: 1rem;
 padding-top: 1rem;
 border-top: 1px solid rgba(74, 144, 226, 0.3);
 font-size: 0.85rem;
 color: #ccc;
}

.select-overlay {
 position: absolute;
 bottom: 0;
 left: 0;
 right: 0;
 background: linear-gradient(135deg, #4a90e2, #357abd);
 padding: 1rem;
 text-align: center;
 color: white;
 font-weight: bold;
 transform: translateY(100%);
 transition: transform 0.3s ease;
}

.class-choice-btn:hover .select-overlay {
 transform: translateY(0);
}

/* Clickable Progress Steps in Free Build Mode */
.progress-step.clickable {
 cursor: pointer;
 transition: all 0.3s ease;
}

.progress-step.clickable:hover {
 transform: scale(1.1);
}

.progress-step.clickable:hover .step-number {
 background: linear-gradient(135deg, #4a90e2, #357abd);
 box-shadow: 0 0 15px rgba(74, 144, 226, 0.6);
}

.progress-step.clickable:hover .step-label {
 color: #4a90e2;
}

/* Tooltip styles for feat descriptions */
.feat-with-tooltip {
 position: relative;
}

.feat-with-tooltip::after {
 content: attr(data-tooltip);
 position: absolute;
 bottom: 100%;
 left: 50%;
 transform: translateX(-50%) translateY(-8px);
 background: rgba(0, 0, 0, 0.95);
 color: #ffffff;
 padding: 12px 16px;
 border-radius: 6px;
 font-size: 0.9rem;
 line-height: 1.4;
 white-space: normal;
 max-width: 350px;
 width: max-content;
 border: 1px solid #00d9ff;
 box-shadow: 0 4px 12px rgba(0, 217, 255, 0.3);
 pointer-events: none;
 opacity: 0;
 visibility: hidden;
 transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
 z-index: 1000;
}

.feat-with-tooltip:hover::after {
 opacity: 1;
 visibility: visible;
 transform: translateX(-50%) translateY(-4px);
}

/* Tooltip arrow */
.feat-with-tooltip::before {
 content: '';
 position: absolute;
 bottom: 100%;
 left: 50%;
 transform: translateX(-50%) translateY(2px);
 border: 6px solid transparent;
 border-top-color: #00d9ff;
 pointer-events: none;
 opacity: 0;
 visibility: hidden;
 transition: opacity 0.3s, visibility 0.3s;
 z-index: 1001;
}

.feat-with-tooltip:hover::before {
 opacity: 1;
 visibility: visible;
}

/* ===========================
   CHEVRON PROGRESS INDICATOR
   =========================== */
.chargen-progress-chevron {
 display: flex;
 justify-content: center;
 align-items: center;
 padding: 1rem 0.5rem;
 background: rgba(0, 0, 0, 0.2);
 border-bottom: 2px solid rgba(10, 116, 218, 0.3);
 overflow-x: auto;
 gap: 0;
}

.chevron-step {
 position: relative;
 flex: 0 0 auto;
 min-width: 120px;
 height: 50px;
 display: flex;
 align-items: center;
 justify-content: center;
 background: #2a2a3e;
 color: #888;
 font-size: 0.85rem;
 font-weight: 600;
 text-transform: uppercase;
 letter-spacing: 0.5px;
 padding: 0 25px 0 15px;
 margin-right: -15px;
 clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 50%, calc(100% - 20px) 100%, 0 100%, 15px 50%);
 transition: all 0.3s ease;
 border: 1px solid rgba(255, 255, 255, 0.1);
 z-index: 1;
}

.chevron-step:first-child {
 clip-path: polygon(0 0, calc(100% - 20px) 0, 100% 50%, calc(100% - 20px) 100%, 0 100%);
 padding-left: 15px;
}

.chevron-step.active {
 background: linear-gradient(135deg, #0a74da 0%, #0d5ba6 100%);
 color: #ffffff;
 z-index: 3;
 border-color: #00d9ff;
 box-shadow: 0 0 15px rgba(10, 116, 218, 0.5);
}

.chevron-step.completed {
 background: #1a5080;
 color: #b3d9ff;
 border-color: rgba(10, 116, 218, 0.5);
}

.chevron-step.clickable {
 cursor: pointer;
}

.chevron-step.clickable:hover {
 background: #3a4a5e;
 color: #ffffff;
 transform: scale(1.05);
 z-index: 4;
}

.chevron-step.active.clickable:hover {
 background: linear-gradient(135deg, #0d88ff 0%, #0a6ec0 100%);
}

.chevron-label {
 position: relative;
 z-index: 2;
 white-space: nowrap;
}

/* ===========================
   LANGUAGE SELECTION STYLES
   =========================== */
.language-counter-box {
 background: linear-gradient(135deg, rgba(10, 116, 218, 0.15) 0%, rgba(13, 91, 166, 0.15) 100%);
 border: 2px solid #0a74da;
 border-radius: 8px;
 padding: 1.5rem;
 margin-bottom: 2rem;
 text-align: center;
}

.counter-display {
 font-size: 1.5rem;
 font-weight: bold;
 color: #00d9ff;
}

.counter-display i {
 margin-right: 0.5rem;
}

.counter-value {
 color: #ff6b6b;
 font-size: 2rem;
 margin: 0 0.5rem;
}

.counter-total {
 color: #00d9ff;
 font-size: 2rem;
}

.no-additional-languages {
 color: #aaa;
 font-size: 1rem;
}

.granted-languages-section,
.selected-additional-languages-section {
 background: rgba(0, 0, 0, 0.2);
 border-radius: 8px;
 padding: 1.5rem;
 margin-bottom: 2rem;
}

.granted-languages-section h4,
.selected-additional-languages-section h4 {
 color: #0a74da;
 margin-bottom: 1rem;
 font-size: 1.2rem;
}

.section-description {
 color: #aaa;
 font-size: 0.9rem;
 margin-bottom: 1rem;
}

.granted-languages-list,
.selected-additional-languages-list {
 display: flex;
 flex-wrap: wrap;
 gap: 0.75rem;
}

.language-item {
 display: flex;
 align-items: center;
 gap: 0.5rem;
 background: rgba(10, 116, 218, 0.2);
 border: 2px solid #0a74da;
 border-radius: 6px;
 padding: 0.75rem 1rem;
 font-size: 1rem;
 font-weight: 600;
 transition: all 0.3s ease;
}

.language-item.granted {
 background: rgba(76, 175, 80, 0.2);
 border-color: #4caf50;
}

.language-item.granted i {
 color: #4caf50;
}

.language-item.selected {
 background: rgba(0, 217, 255, 0.2);
 border-color: #00d9ff;
}

.language-item.selected i {
 color: #00d9ff;
}

.language-name {
 flex: 1;
}

.language-badge {
 background: rgba(76, 175, 80, 0.3);
 padding: 0.25rem 0.5rem;
 border-radius: 4px;
 font-size: 0.75rem;
 color: #4caf50;
}

.remove-language {
 background: rgba(255, 107, 107, 0.2);
 border: none;
 border-radius: 4px;
 padding: 0.25rem 0.5rem;
 cursor: pointer;
 color: #ff6b6b;
 transition: all 0.2s ease;
}

.remove-language:hover {
 background: rgba(255, 107, 107, 0.4);
 color: #ffffff;
}

.no-selection-yet {
 color: #888;
 font-style: italic;
 padding: 1rem;
 text-align: center;
}

.understands-languages {
 margin-top: 1rem;
 padding: 1rem;
 background: rgba(255, 193, 7, 0.1);
 border-left: 3px solid #ffc107;
 border-radius: 4px;
}

.understands-languages i {
 color: #ffc107;
 margin-right: 0.5rem;
}

.available-languages-section {
 margin-top: 2rem;
}

.available-languages-section h4 {
 color: #0a74da;
 margin-bottom: 1.5rem;
 font-size: 1.3rem;
}

.language-category {
 margin-bottom: 2.5rem;
}

.category-name {
 color: #00d9ff;
 font-size: 1.1rem;
 margin-bottom: 0.5rem;
 display: flex;
 align-items: center;
 gap: 0.5rem;
}

.category-description {
 color: #aaa;
 font-size: 0.9rem;
 margin-bottom: 1rem;
 font-style: italic;
}

.languages-grid {
 display: grid;
 grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
 gap: 0.75rem;
}

.language-button {
 background: rgba(42, 42, 62, 0.8);
 border: 2px solid rgba(10, 116, 218, 0.5);
 border-radius: 6px;
 padding: 0.75rem 1rem;
 color: #e4e4e4;
 font-size: 0.9rem;
 font-weight: 500;
 cursor: pointer;
 transition: all 0.3s ease;
 text-align: center;
}

.language-button:hover {
 background: rgba(10, 116, 218, 0.3);
 border-color: #0a74da;
 color: #ffffff;
 transform: translateY(-2px);
 box-shadow: 0 4px 8px rgba(10, 116, 218, 0.3);
}

.language-button:active {
 transform: translateY(0);
}

/* ===========================
   ENHANCED SUMMARY PAGE
   =========================== */
.step-summary {
 max-width: 1200px;
 margin: 0 auto;
}

.summary-intro {
 text-align: center;
 color: #aaa;
 font-size: 1.1rem;
 margin-bottom: 2rem;
}

.summary-grid {
 display: grid;
 grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
 gap: 1.5rem;
 margin-bottom: 2rem;
}

.summary-card {
 background: rgba(0, 0, 0, 0.3);
 border: 2px solid rgba(10, 116, 218, 0.3);
 border-radius: 8px;
 padding: 1.5rem;
 transition: all 0.3s ease;
}

.summary-card:hover {
 border-color: #0a74da;
 box-shadow: 0 4px 12px rgba(10, 116, 218, 0.2);
}

.summary-card h4 {
 color: #0a74da;
 font-size: 1.2rem;
 margin-bottom: 1rem;
 display: flex;
 align-items: center;
 gap: 0.5rem;
 border-bottom: 2px solid rgba(10, 116, 218, 0.3);
 padding-bottom: 0.5rem;
}

.summary-list {
 display: grid;
 grid-template-columns: auto 1fr;
 gap: 0.5rem 1rem;
 align-items: center;
}

.summary-list dt {
 color: #aaa;
 font-weight: 600;
}

.summary-list dd {
 color: #e4e4e4;
 margin: 0;
}

.summary-list-items {
 list-style: none;
 padding: 0;
 margin: 0;
}

.summary-list-items li {
 padding: 0.5rem 0;
 border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.summary-list-items li:last-child {
 border-bottom: none;
}

.summary-list-items .no-items {
 color: #888;
 font-style: italic;
}

.abilities-grid {
 display: grid;
 grid-template-columns: repeat(3, 1fr);
 gap: 1rem;
}

.ability-box {
 display: flex;
 flex-direction: column;
 align-items: center;
 background: rgba(10, 116, 218, 0.1);
 border: 2px solid rgba(10, 116, 218, 0.3);
 border-radius: 8px;
 padding: 1rem;
 text-align: center;
}

.ability-label {
 font-size: 0.8rem;
 color: #aaa;
 font-weight: 700;
 text-transform: uppercase;
 letter-spacing: 1px;
}

.ability-score {
 font-size: 2rem;
 font-weight: bold;
 color: #00d9ff;
 margin: 0.25rem 0;
}

.ability-modifier {
 font-size: 1rem;
 color: #4caf50;
 font-weight: 600;
}

.language-chips {
 display: flex;
 flex-wrap: wrap;
 gap: 0.5rem;
}

.language-chip {
 background: rgba(10, 116, 218, 0.2);
 border: 1px solid #0a74da;
 border-radius: 20px;
 padding: 0.5rem 1rem;
 font-size: 0.9rem;
 color: #00d9ff;
}

.summary-confirmation {
 background: linear-gradient(135deg, rgba(76, 175, 80, 0.15) 0%, rgba(56, 142, 60, 0.15) 100%);
 border: 2px solid #4caf50;
 border-radius: 8px;
 padding: 2rem;
 text-align: center;
 margin-bottom: 2rem;
}

.confirmation-box {
 display: flex;
 flex-direction: column;
 align-items: center;
 gap: 1rem;
}

.confirmation-box i {
 font-size: 3rem;
 color: #4caf50;
}

.confirmation-box p {
 margin: 0;
 font-size: 1.1rem;
}

.confirmation-box strong {
 color: #4caf50;
 font-size: 1.3rem;
}

/* ===========================
   CUSTOM LANGUAGE SECTION
   =========================== */
.custom-language-section {
 margin-top: 2rem;
 padding: 2rem;
 background: linear-gradient(135deg, rgba(156, 39, 176, 0.1) 0%, rgba(123, 31, 162, 0.1) 100%);
 border: 2px dashed rgba(156, 39, 176, 0.5);
 border-radius: 8px;
 text-align: center;
}

.add-custom-language-btn {
 background: linear-gradient(135deg, #9c27b0 0%, #7b1fa2 100%);
 border: 2px solid #ba68c8;
 border-radius: 8px;
 padding: 1rem 2rem;
 color: #ffffff;
 font-size: 1rem;
 font-weight: 600;
 cursor: pointer;
 transition: all 0.3s ease;
 display: inline-flex;
 align-items: center;
 gap: 0.5rem;
}

.add-custom-language-btn:hover {
 background: linear-gradient(135deg, #ab47bc 0%, #8e24aa 100%);
 transform: translateY(-2px);
 box-shadow: 0 6px 20px rgba(156, 39, 176, 0.4);
}

.add-custom-language-btn:active {
 transform: translateY(0);
}

.add-custom-language-btn i {
 font-size: 1.2rem;
}

.custom-language-hint {
 margin-top: 0.75rem;
 color: #ba68c8;
 font-size: 0.9rem;
 font-style: italic;
}
</style>

</div><!-- swse-sheet -->