<div class="mentor-chat-dialog swse kotor-style">

  {{#if selectedMentor}}
    <!-- MENTOR SELECTED - SHOW CHAT INTERFACE -->
    <div class="chat-view">

      <!-- Back to Mentors Button -->
      <button class="back-to-mentors" type="button">
        <i class="{{getIconClass 'arrowLeft'}}"></i> Back to Mentors
      </button>

      <!-- Mentor Conversation Box (KOTOR-style) -->
      <div class="kotor-conversation-box">

        <!-- Mentor Portrait (central, larger) -->
        <div class="kotor-portrait-area">
          {{#if selectedMentor.mentor.portrait}}
            <img src="{{selectedMentor.mentor.portrait}}" alt="{{selectedMentor.mentor.name}}" class="kotor-mentor-portrait" />
          {{/if}}
        </div>

        <!-- Mentor Name/Title below portrait -->
        <div class="kotor-mentor-nameplate">
          <h2>{{selectedMentor.mentor.name}}</h2>
          <p class="mentor-title">{{selectedMentor.mentor.title}}</p>
        </div>

        {{#if currentTopic}}
          <!-- TOPIC SELECTED - SHOW RESPONSE -->
          <div class="kotor-response-section">

            <!-- Mentor Dialogue Box -->
            <div class="kotor-dialogue-box">
              {{#if currentResponse.introduction}}
                <div class="dialogue-line">
                  {{{currentResponse.introduction}}}
                </div>
              {{/if}}

              {{#if currentResponse.advice}}
                <div class="dialogue-line advice-line">
                  {{{currentResponse.advice}}}
                </div>
              {{/if}}

              {{#if currentResponse.suggestions}}
                <div class="dialogue-suggestions">
                  <p class="suggestions-header">Top Recommendations:</p>
                  <ul>
                    {{#each currentResponse.suggestions}}
                      <li><span class="suggestion-name">{{this.name}}</span> â€” {{this.reason}}</li>
                    {{/each}}
                  </ul>
                </div>
              {{/if}}
            </div>

            <!-- System Analysis Panel (Reasoning) -->
            {{#if currentResponse.reasonTexts}}
              {{#if currentResponse.reasonTexts.length}}
                <div class="system-analysis-panel">
                  <p class="analysis-label">System Analysis</p>
                  <ul class="reason-list">
                    {{#each currentResponse.reasonTexts}}
                      <li class="reason-item">{{this.text}}</li>
                    {{/each}}
                  </ul>
                </div>
              {{/if}}
            {{/if}}

            <!-- Response Options -->
            <div class="kotor-response-options">
              <button class="back-to-topics response-option" type="button">
                <i class="{{getIconClass 'arrowLeft'}}"></i> Back to Topics
              </button>
            </div>

          </div>

        {{else}}
          <!-- NO TOPIC SELECTED - SHOW TOPIC LIST -->
          <div class="kotor-topics-section">

            <!-- Mentor Greeting -->
            <div class="kotor-dialogue-box">
              {{#if currentResponse.introduction}}
                <p class="dialogue-line">{{{currentResponse.introduction}}}</p>
              {{else}}
                <p class="dialogue-line">What can I help you with?</p>
              {{/if}}
            </div>

            <!-- Topic Selection (conversation options) -->
            <div class="kotor-response-options topics-options">
              <p class="options-label">What would you like to discuss?</p>
              {{#each topics}}
                <button class="topic-button response-option" data-topic="{{this.key}}" type="button">
                  <i class="fa-solid {{this.icon}}"></i>
                  {{this.title}}
                </button>
              {{/each}}
            </div>

          </div>
        {{/if}}

      </div>

    </div>

  {{else}}
    <!-- NO MENTOR SELECTED - SHOW MENTOR LIST -->
    <div class="mentor-selection">

      {{#if hasMentors}}
        <!-- Intro Text -->
        <div class="selection-intro">
          <p>Select a mentor to seek their guidance. These mentors have been unlocked through your class training:</p>
        </div>

        <!-- Mentor Grid -->
        <div class="mentors-grid">
          {{#each unlockedMentors}}
            <div class="mentor-card" data-mentor="{{this.key}}">
              {{#if this.mentor.portrait}}
                <img src="{{this.mentor.portrait}}" alt="{{this.mentor.name}}" class="mentor-card-portrait" />
              {{/if}}
              <div class="mentor-card-info">
                <h4>{{this.mentor.name}}</h4>
                <p class="mentor-card-title">{{this.mentor.title}}</p>
                <p class="mentor-card-unlocked">Unlocked via: <em>{{this.unlockedBy}}</em></p>
              </div>
            </div>
          {{/each}}
        </div>

      {{else}}
        <!-- No Mentors Available -->
        <div class="no-mentors">
          <i class="{{getIconClass 'user'}}-slash" style="font-size: 48px; opacity: 0.3; margin-bottom: 15px;"></i>
          <p>You haven't unlocked any mentors yet.</p>
          <p>Take a class to gain access to mentor guidance!</p>
        </div>
      {{/if}}

    </div>
  {{/if}}

</div>

