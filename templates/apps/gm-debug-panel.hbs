<div class="gm-debug-panel">
  <header class="debug-header">
    <div class="header-info">
      <h2><i class="{{getIconClass 'bug'}}"></i> BuildIntent Analysis</h2>
      <p class="character-name">{{actor.name}} (Level {{actor.system.level}})</p>
    </div>
    <div class="header-actions">
      <button class="refresh-analysis" title="Refresh Analysis">
        <i class="fas fa-arrows-rotate"></i>
      </button>
      <button class="copy-json" title="Copy JSON to Clipboard">
        <i class="{{getIconClass 'PLACEHOLDER_'}}"></i>
      </button>
    </div>
  </header>

  <nav class="debug-tabs">
    <a class="tab" data-tab="overview"><i class="{{getIconClass 'chartPie'}}"></i> Overview</a>
    <a class="tab" data-tab="prestige"><i class="{{getIconClass 'crown'}}"></i> Prestige</a>
    <a class="tab" data-tab="signals"><i class="{{getIconClass 'signal'}}"></i> Signals</a>
    <a class="tab" data-tab="classes"><i class="{{getIconClass 'users'}}"></i> Classes</a>
    <a class="tab" data-tab="raw"><i class="{{getIconClass 'code'}}"></i> Raw JSON</a>
  </nav>

  <div class="debug-content">
    {{!-- OVERVIEW TAB --}}
    <section class="tab-section" data-tab="overview">
      {{#if buildIntent}}
      <div class="overview-grid">
        {{!-- Combat Style --}}
        <div class="overview-card">
          <h3><i class="{{getIconClass 'PLACEHOLDER_'}}"></i> Combat Style</h3>
          <div class="combat-style {{combatStyle}}">
            {{#if (eq combatStyle "lightsaber")}}
            <i class="{{getIconClass 'jedi'}}"></i> Lightsaber
            {{else if (eq combatStyle "ranged")}}
            <i class="{{getIconClass 'target'}}"></i> Ranged
            {{else if (eq combatStyle "melee")}}
            <i class="{{getIconClass 'fist'}}"></i> Melee
            {{else}}
            <i class="{{getIconClass 'random'}}"></i> Mixed
            {{/if}}
          </div>
        </div>

        {{!-- Force Focus --}}
        <div class="overview-card">
          <h3><i class="{{getIconClass 'atom'}}"></i> Force Focus</h3>
          <div class="force-focus {{#if forceFocus}}active{{/if}}">
            {{#if forceFocus}}
            <i class="{{getIconClass 'success'}}"></i> Force-Focused
            {{else}}
            <i class="{{getIconClass 'error'}}"></i> Non-Force
            {{/if}}
          </div>
        </div>

        {{!-- Primary Themes --}}
        <div class="overview-card wide">
          <h3><i class="{{getIconClass 'tag'}}s"></i> Primary Themes</h3>
          <div class="primary-themes">
            {{#each buildIntent.primaryThemes}}
            <span class="theme-badge primary">{{this}}</span>
            {{else}}
            <span class="no-data">No strong themes detected</span>
            {{/each}}
          </div>
        </div>
      </div>

      {{!-- Theme Scores --}}
      <div class="collapsible-section">
        <div class="collapsible-header">
          <h3><i class="{{getIconClass 'chartBar'}}"></i> Theme Scores</h3>
          <i class="{{getIconClass 'chevronDown'}}"></i>
        </div>
        <div class="collapsible-content">
          <div class="theme-scores">
            {{#each themeScores}}
            <div class="theme-score-row {{#if isPrimary}}is-primary{{/if}}">
              <span class="theme-name">
                {{#if isPrimary}}<i class="{{getIconClass 'star'}}"></i>{{/if}}
                {{name}}
              </span>
              <div class="theme-bar-container">
                <div class="theme-bar" style="width: {{percentage}}%; background-color: {{barColor}};"></div>
              </div>
              <span class="theme-value">{{percentage}}%</span>
            </div>
            {{else}}
            <p class="no-data">No theme signals detected</p>
            {{/each}}
          </div>
        </div>
      </div>

      {{!-- Priority Prerequisites --}}
      <div class="collapsible-section">
        <div class="collapsible-header">
          <h3><i class="{{getIconClass 'exclamation'}}"></i> Priority Prerequisites</h3>
          <i class="{{getIconClass 'chevronDown'}}"></i>
        </div>
        <div class="collapsible-content">
          <div class="priority-prereqs">
            {{#each priorityPrereqs}}
            <div class="prereq-item">
              <i class="fas {{icon}}"></i>
              <span class="prereq-name">{{name}}</span>
              <span class="prereq-type">({{type}})</span>
              <span class="prereq-for">for {{forClass}}</span>
              <span class="prereq-confidence">{{confidence}}%</span>
            </div>
            {{else}}
            <p class="no-data">No priority prerequisites identified</p>
            {{/each}}
          </div>
        </div>
      </div>
      {{else}}
      <div class="error-state">
        <i class="{{getIconClass 'exclamation'}}"></i>
        <p>Failed to analyze build intent. Check console for errors.</p>
      </div>
      {{/if}}
    </section>

    {{!-- PRESTIGE TAB --}}
    <section class="tab-section" data-tab="prestige">
      <h3><i class="{{getIconClass 'crown'}}"></i> Prestige Class Affinities</h3>
      <p class="tab-description">Classes ranked by how well they match the character's build direction.</p>

      <div class="prestige-affinities">
        {{#each prestigeAffinities}}
        <div class="affinity-card confidence-{{confidenceLevel}}">
          <div class="affinity-header">
            <h4>{{className}}</h4>
            <span class="confidence-badge">{{confidence}}%</span>
          </div>
          <div class="confidence-bar-container">
            <div class="confidence-bar" style="width: {{confidence}}%;"></div>
          </div>
          <div class="match-details">
            <span class="match-summary">{{matchSummary}}</span>
            {{#if matches.feats.length}}
            <div class="match-group">
              <strong>Feats:</strong> {{#each matches.feats}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
            </div>
            {{/if}}
            {{#if matches.skills.length}}
            <div class="match-group">
              <strong>Skills:</strong> {{#each matches.skills}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
            </div>
            {{/if}}
            {{#if matches.talentTrees.length}}
            <div class="match-group">
              <strong>Trees:</strong> {{#each matches.talentTrees}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
            </div>
            {{/if}}
          </div>
        </div>
        {{else}}
        <p class="no-data">No prestige class affinities detected. The character needs more progression signals.</p>
        {{/each}}
      </div>
    </section>

    {{!-- SIGNALS TAB --}}
    <section class="tab-section" data-tab="signals">
      <h3><i class="{{getIconClass 'signal'}}"></i> Detected Signals</h3>
      <p class="tab-description">Individual choices that influenced the build intent analysis.</p>

      {{#if signals}}
      <div class="signals-grid">
        {{!-- Feat Signals --}}
        <div class="signal-group">
          <h4><i class="{{getIconClass 'star'}}"></i> Feats ({{signals.feats.length}})</h4>
          <div class="signal-list">
            {{#each signals.feats}}
            <div class="signal-item">
              <span class="signal-name">{{name}}</span>
              <span class="signal-theme" style="background-color: {{color}};">{{theme}}</span>
            </div>
            {{else}}
            <p class="no-data">No feat signals</p>
            {{/each}}
          </div>
        </div>

        {{!-- Skill Signals --}}
        <div class="signal-group">
          <h4><i class="{{getIconClass 'PLACEHOLDER_'}}"></i> Skills ({{signals.skills.length}})</h4>
          <div class="signal-list">
            {{#each signals.skills}}
            <div class="signal-item">
              <span class="signal-name">{{name}}</span>
              <span class="signal-theme" style="background-color: {{color}};">{{theme}}</span>
            </div>
            {{else}}
            <p class="no-data">No skill signals</p>
            {{/each}}
          </div>
        </div>

        {{!-- Class Signals --}}
        <div class="signal-group">
          <h4><i class="{{getIconClass 'users'}}"></i> Classes ({{signals.classes.length}})</h4>
          <div class="signal-list">
            {{#each signals.classes}}
            <div class="signal-item">
              <span class="signal-name">{{name}}</span>
              <span class="signal-theme" style="background-color: {{color}};">{{theme}}</span>
            </div>
            {{else}}
            <p class="no-data">No class signals</p>
            {{/each}}
          </div>
        </div>
      </div>
      {{else}}
      <p class="no-data">No signal data available</p>
      {{/if}}
    </section>

    {{!-- CLASSES TAB --}}
    <section class="tab-section" data-tab="classes">
      <h3><i class="{{getIconClass 'users'}}"></i> Prestige Class Qualification</h3>
      <p class="tab-description">Detailed prerequisite status for each prestige class.</p>

      <div class="class-analysis">
        {{#each classAnalysis}}
        <div class="class-analysis-card {{#if qualified}}qualified{{else}}not-qualified{{/if}}">
          <div class="class-header">
            <h4>
              {{#if qualified}}<i class="{{getIconClass 'success'}}"></i>{{else}}<i class="{{getIconClass 'error'}}"></i>{{/if}}
              {{name}}
            </h4>
            <span class="synergy-score">Synergy: {{synergyScore}}</span>
          </div>
          {{#unless qualified}}
          <div class="missing-prereqs">
            <strong>Missing ({{missingCount}}):</strong>
            <ul>
              {{#each missing}}
              <li class="{{#if unverifiable}}unverifiable{{/if}}">
                {{display}}
                {{#if unverifiable}}<span class="unverifiable-badge">(manual)</span>{{/if}}
              </li>
              {{/each}}
            </ul>
          </div>
          {{/unless}}
        </div>
        {{else}}
        <p class="no-data">No prestige class data available</p>
        {{/each}}
      </div>
    </section>

    {{!-- RAW JSON TAB --}}
    <section class="tab-section" data-tab="raw">
      <h3><i class="{{getIconClass 'code'}}"></i> Raw BuildIntent JSON</h3>
      <p class="tab-description">Complete BuildIntent data for debugging and export.</p>
      <pre class="json-output">{{rawBuildIntent}}</pre>
    </section>
  </div>
</div>

