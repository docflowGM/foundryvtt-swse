<div class="prestige-roadmap">
  <header class="roadmap-header">
    <div class="header-info">
      <h2><i class="{{getIconClass 'road'}}"></i> Prestige Class Roadmap</h2>
      <p class="character-name">{{actor.name}} (Level {{actor.system.level}})</p>
    </div>
    <div class="roadmap-summary">
      <div class="summary-stat qualified">
        <i class="{{getIconClass 'success'}}"></i>
        <span class="stat-value">{{roadmap.summary.qualifiedCount}}</span>
        <span class="stat-label">Qualified</span>
      </div>
      <div class="summary-stat in-progress">
        <i class="{{getIconClass 'spinner'}}"></i>
        <span class="stat-value">{{roadmap.summary.inProgressCount}}</span>
        <span class="stat-label">In Progress</span>
      </div>
      <div class="summary-stat recommended">
        <i class="{{getIconClass 'star'}}"></i>
        <span class="stat-value">{{roadmap.summary.recommendedCount}}</span>
        <span class="stat-label">Recommended</span>
      </div>
    </div>
  </header>

  <div class="roadmap-content">
    {{!-- QUALIFIED CLASSES --}}
    {{#if roadmap.qualified.length}}
    <section class="roadmap-section qualified-section">
      <div class="section-header">
        <h3><i class="{{getIconClass 'trophy'}}"></i> Qualified Now</h3>
        <i class="{{getIconClass 'chevronDown'}}"></i>
      </div>
      <div class="section-content">
        <div class="roadmap-cards">
          {{#each roadmap.qualified}}
          <div class="roadmap-class-card qualified {{#if (eq ../selectedClass this.name)}}selected{{/if}}"
               data-class-name="{{this.name}}">
            <div class="card-header">
              <i class="{{getIconClass 'crown'}}"></i>
              <h4>{{this.name}}</h4>
            </div>
            <div class="progress-indicator full">
              <div class="progress-bar" style="width: 100%;"></div>
            </div>
            <div class="card-status">
              <span class="status-badge qualified">Ready!</span>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </section>
    {{/if}}

    {{!-- IN PROGRESS CLASSES --}}
    {{#if roadmap.inProgress.length}}
    <section class="roadmap-section in-progress-section">
      <div class="section-header">
        <h3><i class="fa-solid fa-list-check"></i> In Progress</h3>
        <i class="{{getIconClass 'chevronDown'}}"></i>
      </div>
      <div class="section-content">
        <div class="roadmap-cards">
          {{#each roadmap.inProgress}}
          <div class="roadmap-class-card in-progress {{#if (eq ../selectedClass this.name)}}selected{{/if}}"
               data-class-name="{{this.name}}">
            <div class="card-header">
              <i class="{{getIconClass 'unlock'}}"></i>
              <h4>{{this.name}}</h4>
              <span class="levels-away">{{this.levelsAway}} lvl</span>
            </div>
            <div class="progress-indicator">
              <div class="progress-bar" style="width: {{this.progressPercent}}%;"></div>
              <span class="progress-text">{{this.progressPercent}}%</span>
            </div>
            <div class="prereq-summary">
              <span>{{this.metPrereqs}}/{{this.totalPrereqs}} prerequisites met</span>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </section>
    {{/if}}

    {{!-- RECOMMENDED CLASSES --}}
    {{#if roadmap.recommended.length}}
    <section class="roadmap-section recommended-section">
      <div class="section-header">
        <h3><i class="{{getIconClass 'compass'}}"></i> Recommended for Your Build</h3>
        <i class="{{getIconClass 'chevronDown'}}"></i>
      </div>
      <div class="section-content">
        <div class="roadmap-cards">
          {{#each roadmap.recommended}}
          <div class="roadmap-class-card recommended {{#if (eq ../selectedClass this.name)}}selected{{/if}}"
               data-class-name="{{this.name}}">
            <div class="card-header">
              <i class="{{getIconClass 'star'}}"></i>
              <h4>{{this.name}}</h4>
              <span class="affinity-badge">{{this.affinityPercent}}% match</span>
            </div>
            <div class="progress-indicator">
              <div class="progress-bar" style="width: {{this.progressPercent}}%;"></div>
              <span class="progress-text">{{this.progressPercent}}%</span>
            </div>
            <div class="prereq-summary">
              <span>{{this.metPrereqs}}/{{this.totalPrereqs}} prerequisites met</span>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </section>
    {{/if}}

    {{!-- OTHER CLASSES (collapsed by default) --}}
    {{#if roadmap.other.length}}
    <section class="roadmap-section other-section collapsed">
      <div class="section-header">
        <h3><i class="{{getIconClass 'PLACEHOLDER_'}}"></i> Other Prestige Classes ({{roadmap.other.length}})</h3>
        <i class="{{getIconClass 'chevronDown'}}"></i>
      </div>
      <div class="section-content">
        <div class="roadmap-cards compact">
          {{#each roadmap.other}}
          <div class="roadmap-class-card other {{#if (eq ../selectedClass this.name)}}selected{{/if}}"
               data-class-name="{{this.name}}">
            <div class="card-header">
              <h4>{{this.name}}</h4>
            </div>
            <div class="progress-mini">
              <div class="progress-bar" style="width: {{this.progressPercent}}%;"></div>
            </div>
          </div>
          {{/each}}
        </div>
      </div>
    </section>
    {{/if}}
  </div>

  {{!-- DETAIL PANEL --}}
  {{#if selectedClassData}}
  <aside class="roadmap-detail-panel">
    <div class="detail-header">
      <h3>{{selectedClassData.name}}</h3>
      <button class="close-detail" title="Close"><i class="{{getIconClass 'times'}}"></i></button>
    </div>

    <div class="detail-progress">
      <div class="progress-circle" data-progress="{{selectedClassData.progressPercent}}">
        <svg viewBox="0 0 36 36">
          <path class="progress-bg"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
          <path class="progress-bar"
                stroke-dasharray="{{selectedClassData.progressPercent}}, 100"
                d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
        </svg>
        <div class="progress-text">{{selectedClassData.progressPercent}}%</div>
      </div>
      {{#if selectedClassData.qualified}}
      <span class="status-label qualified">Qualified!</span>
      {{else}}
      <span class="status-label">{{selectedClassData.levelsAway}} level(s) away</span>
      {{/if}}
    </div>

    <div class="prereq-checklist">
      <h4>Prerequisites</h4>
      {{#each selectedClassData.prereqBreakdown}}
      <div class="prereq-item {{#if this.isMet}}met{{else}}unmet{{/if}} {{#if this.unverifiable}}unverifiable{{/if}}">
        <div class="prereq-icon">
          {{#if this.isMet}}
          <i class="{{getIconClass 'success'}}"></i>
          {{else if this.unverifiable}}
          <i class="{{getIconClass 'circle'}}-question"></i>
          {{else}}
          <i class="{{getIconClass 'circle'}}"></i>
          {{/if}}
        </div>
        <div class="prereq-info">
          <span class="prereq-name">{{this.name}}</span>
          {{#if this.current}}
          <span class="prereq-progress">{{this.current}}/{{this.required}}</span>
          {{/if}}
        </div>
        {{#unless this.isMet}}
        {{#unless this.unverifiable}}
        <div class="prereq-bar-mini">
          <div class="bar" style="width: {{this.progress}}%;"></div>
        </div>
        {{/unless}}
        {{/unless}}
      </div>
      {{/each}}
    </div>

    {{#if selectedClassData.recommendations.length}}
    <div class="recommendations-panel">
      <h4>Next Steps</h4>
      <ol class="recommendation-list">
        {{#each selectedClassData.recommendations}}
        <li class="rec-{{this.priority}}">
          <i class="{{getIconClass 'arrowRight'}}"></i>
          {{this.text}}
        </li>
        {{/each}}
      </ol>
    </div>
    {{/if}}
  </aside>
  {{/if}}
</div>

