<div class="mentor-reflective-dialog swse">
  {{#if currentTopic}}
    <!-- DIALOGUE DISPLAY MODE -->
    <div class="dialogue-view">

      <!-- Back Button -->
      <button class="back-to-topics" type="button">
        <i class="{{getIconClass 'arrowLeft'}}"></i> Back to Topics
      </button>

      <!-- Mentor Header -->
      <div class="mentor-header">
        {{#if mentor.portrait}}
          <img src="{{mentor.portrait}}" alt="{{mentor.name}}" class="mentor-portrait" />
        {{/if}}
        <div class="mentor-info">
          <h2>{{mentor.name}}</h2>
          <p class="mentor-title">{{mentor.title}}</p>
        </div>
      </div>

      <!-- Topic Title -->
      <div class="topic-display">
        <h3>
          <i class="fas {{currentTopic.icon}}"></i>
          {{currentTopic.title}}
        </h3>
        <p class="topic-desc">{{currentTopic.description}}</p>
      </div>

      <!-- Dialogue Content (Three-Layer) -->
      <div class="dialogue-content">

        {{#if currentDialogue.content.observation}}
          <div class="dialogue-layer observation">
            <p class="observation-text">{{currentDialogue.content.observation}}</p>
          </div>
        {{/if}}

        {{#if currentDialogue.content.suggestion}}
          <div class="dialogue-layer suggestion">
            <p class="suggestion-text">{{currentDialogue.content.suggestion}}</p>
          </div>
        {{/if}}

        {{#if currentDialogue.content.respectClause}}
          <div class="dialogue-layer respect-clause">
            <p class="respect-text"><em>{{currentDialogue.content.respectClause}}</em></p>
          </div>
        {{/if}}

      </div>

      <!-- Contextual Actions (if applicable) -->
      {{#if currentDialogue.showPathCommitment}}
      <div class="dialogue-actions">
        <button class="commit-path-btn" data-path="guardian" type="button">
          <i class="{{getIconClass 'PLACEHOLDER_'}}"></i> Commit to Guardian Path
        </button>
        <button class="commit-path-btn" data-path="striker" type="button">
          <i class="{{getIconClass 'PLACEHOLDER_'}}"></i> Commit to Striker Path
        </button>
        <button class="commit-path-btn" data-path="controller" type="button">
          <i class="fas fa-wand-magic-sparkles"></i> Commit to Controller Path
        </button>
      </div>
      {{/if}}

      {{#if currentDialogue.showTargetClass}}
      <div class="dialogue-actions">
        <button class="set-target-class-btn" type="button">
          <i class="{{getIconClass 'crown'}}"></i> Set Prestige Target
        </button>
      </div>
      {{/if}}

      <!-- DSP Context (if relevant) -->
      {{#if currentDialogue.dspContext.saturation}}
        <div class="dsp-context {{currentDialogue.dspContext.band}}">
          <small>
            <i class="{{getIconClass 'heart'}}"></i>
            Darkness Saturation: {{currentDialogue.dspContext.band}}
            ({{multiply currentDialogue.dspContext.saturation 100}}%)
          </small>
        </div>
      {{/if}}

    </div>

  {{else}}
    <!-- TOPIC SELECTION MODE -->
    <div class="topics-view">

      <!-- Mentor Greeting -->
      <div class="mentor-welcome">
        {{#if mentor.portrait}}
          <img src="{{mentor.portrait}}" alt="{{mentor.name}}" class="mentor-portrait-large" />
        {{/if}}
        <div class="welcome-text">
          <h2>{{mentor.name}}, {{mentor.title}}</h2>
          <p>What do you wish to discuss?</p>
        </div>
      </div>

      <!-- Topics Grid -->
      <div class="topics-grid">
        {{#each topics}}
          <button class="topic-button" data-topic="{{this.key}}" type="button">
            <div class="topic-icon">
              <i class="fas {{this.icon}}"></i>
            </div>
            <div class="topic-text">
              <h4>{{this.title}}</h4>
              <p>{{this.description}}</p>
            </div>
          </button>
        {{/each}}
      </div>

      <!-- Character Info -->
      <div class="character-info">
        <div class="info-box">
          <strong>{{actor.name}}</strong>
          <span>Level {{actor.system.level}}</span>
        </div>
        {{#if mentorMemory.inferredRole}}
          <div class="info-box">
            <strong>Inferred Role</strong>
            <span>{{mentorMemory.inferredRole}}</span>
          </div>
        {{/if}}
        {{#if mentorMemory.committedPath}}
          <div class="info-box committed">
            <i class="{{getIconClass 'check'}}"></i>
            <strong>Committed Path</strong>
            <span>{{mentorMemory.committedPath}}</span>
          </div>
        {{/if}}
      </div>

    </div>

  {{/if}}

</div>

