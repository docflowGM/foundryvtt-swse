{{!-- SWSE NPC Sheet - Roll20 Inspired Design --}}
{{!-- File: templates/actors/npc-sheet.hbs --}}

<form class="swse npc-sheet {{cssClass}} holo-theme" autocomplete="off">
    {{!-- Header Section --}}
    <header class="sheet-header">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="80" width="80"/>
        
        <div class="header-fields">
            <h1 class="charname">
                <input name="name" type="text" value="{{actor.name}}" placeholder="NPC Name"/>
            </h1>
            
            <div class="header-row">
                <div class="resource">
                    <label class="resource-label">Species</label>
                    <input type="text" name="system.species" value="{{system.species}}" placeholder="Species"/>
                </div>
                
                <div class="resource">
                    <label class="resource-label">Role</label>
                    <select name="system.role">
                        <option value="minion" {{#if (eq system.role "minion")}}selected{{/if}}>Minion</option>
                        <option value="standard" {{#if (eq system.role "standard")}}selected{{/if}}>Standard</option>
                        <option value="elite" {{#if (eq system.role "elite")}}selected{{/if}}>Elite</option>
                        <option value="boss" {{#if (eq system.role "boss")}}selected{{/if}}>Boss</option>
                    </select>
                </div>
                
                <div class="resource">
                    <label class="resource-label">Level</label>
                    <input type="number" name="system.level" value="{{system.level}}" data-dtype="Number" min="1"/>
                </div>
                
                <div class="resource">
                    <label class="resource-label">CR</label>
                    <input type="number" name="system.cr" value="{{system.cr}}" data-dtype="Number"/>
                </div>
            </div>
        </div>
    </header>

    {{!-- Quick Actions Bar --}}
    <div class="quick-actions">
        <button type="button" class="quick-attack" title="Quick Attack"><i class="fas fa-crosshairs"></i> Attack</button>
        <button type="button" class="quick-save" data-defense="fortitude" title="Fortitude Save"><i class="fas fa-shield-alt"></i> Fort</button>
        <button type="button" class="quick-save" data-defense="reflex" title="Reflex Save"><i class="fas fa-running"></i> Ref</button>
        <button type="button" class="quick-save" data-defense="will" title="Will Save"><i class="fas fa-brain"></i> Will</button>
        <button type="button" class="import-statblock" title="Import Stat Block"><i class="fas fa-file-import"></i> Import</button>
    </div>

    {{!-- Main Stats Grid --}}
    <section class="npc-stats-grid">
        {{!-- Left Column: Abilities & Defenses --}}
        <div class="stats-column">
            <h3 class="section-header">Abilities</h3>
            <div class="abilities-compact">
                {{#each system.abilities as |ability key|}}
                <div class="ability-compact">
                    <label>{{uppercase key}}</label>
                    <input type="number" name="system.abilities.{{key}}.base" value="{{ability.base}}" data-dtype="Number"/>
                    <div class="mod rollable" data-ability="{{key}}">{{numberFormat ability.mod decimals=0 sign=true}}</div>
                </div>
                {{/each}}
            </div>
            
            <h3 class="section-header">Defenses</h3>
            <div class="defenses-compact">
                <div class="defense-compact fortitude">
                    <label>Fort</label>
                    <div class="def-val rollable" data-defense="fortitude">{{system.defenses.fortitude.total}}</div>
                </div>
                <div class="defense-compact reflex">
                    <label>Ref</label>
                    <div class="def-val rollable" data-defense="reflex">{{system.defenses.reflex.total}}</div>
                </div>
                <div class="defense-compact will">
                    <label>Will</label>
                    <div class="def-val rollable" data-defense="will">{{system.defenses.will.total}}</div>
                </div>
            </div>
            
            <div class="npc-vitals">
                <div class="vital-stat">
                    <label>HP</label>
                    <input type="number" name="system.hp.value" value="{{system.hp.value}}" data-dtype="Number" style="width: 60px;"/>
                    <span>/</span>
                    <input type="number" name="system.hp.max" value="{{system.hp.max}}" data-dtype="Number" style="width: 60px;"/>
                </div>
                <div class="vital-stat">
                    <label>DT</label>
                    <span class="dt-display">{{damageThreshold}}</span>
                </div>
                <div class="vital-stat">
                    <label>Speed</label>
                    <span>{{system.speed.total}} sq</span>
                </div>
                <div class="vital-stat">
                    <label>Init</label>
                    <span class="rollable" data-roll="initiative">{{numberFormat system.initiative.total decimals=0 sign=true}}</span>
                </div>
            </div>
        </div>

        {{!-- Right Column: Stat Block & Weapons --}}
        <div class="details-column">
            <h3 class="section-header">Stat Block</h3>
            <textarea name="system.statBlock" rows="8" class="stat-block-text" placeholder="Paste stat block here for quick import...">{{system.statBlock}}</textarea>
            
            <h3 class="section-header">Weapons & Attacks</h3>
            <div class="npc-weapons">
                {{#each weapons}}
                <div class="npc-weapon" data-item-id="{{this._id}}">
                    <div class="weapon-name">{{this.name}}</div>
                    <div class="weapon-stats">{{this.system.damage}}</div>
                    <button type="button" class="roll-weapon rollable" data-item-id="{{this._id}}"><i class="fas fa-dice-d20"></i></button>
                </div>
                {{/each}}
                
                {{!-- Legacy system weapons --}}
                {{#each system.weapons as |weapon index|}}
                <div class="npc-weapon legacy" data-index="{{index}}">
                    <input type="text" name="system.weapons.{{index}}.name" value="{{weapon.name}}" placeholder="Weapon"/>
                    <input type="text" name="system.weapons.{{index}}.damage" value="{{weapon.damage}}" placeholder="Damage" style="width: 80px;"/>
                    <button type="button" class="roll-weapon rollable" data-index="{{index}}"><i class="fas fa-dice-d20"></i></button>
                    <button type="button" class="remove-weapon" data-index="{{index}}"><i class="fas fa-trash"></i></button>
                </div>
                {{/each}}
                
                <button type="button" class="add-weapon"><i class="fas fa-plus"></i> Add Weapon</button>
            </div>
            
            <h3 class="section-header">Special Abilities</h3>
            <div class="special-abilities">
                {{#each feats}}
                <div class="special-ability">
                    <strong>{{this.name}}</strong>
                    {{#if this.system.description}}
                    <p>{{this.system.description}}</p>
                    {{/if}}
                </div>
                {{/each}}
            </div>
        </div>
    </section>

    {{!-- GM Notes --}}
    <section class="gm-notes">
        <h3 class="section-header">GM Notes</h3>
        {{editor system.notes target="system.notes" button=true owner=owner editable=editable}}
    </section>
</form>
