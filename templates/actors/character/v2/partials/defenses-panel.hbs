
<section class="defenses-panel v3-panel holo-panel">

  <header class="section-bar">
    <h3 class="section-header">Defenses</h3>
    <button type="button"
            data-action="toggle-defenses"
            class="swse-btn defenses-toggle">
      More
    </button>
  </header>

  <div class="defenses-container">

    {{#each headerDefenses as |def|}}

      <div class="defense-row defense-{{def.key}}">

        <!-- COLLAPSED -->
        <div class="defense-collapsed">

          <div class="defense-label">
            {{def.label}}
          </div>

          <div class="defense-total" data-defense-breakdown="{{def.key}}" title="Hover for modifier breakdown">
            {{def.total}}
          </div>

        </div>

        <!-- EXPANDED -->
        <div class="defense-expanded">

          <!-- Level (Derived) -->
          <div class="math-pill derived">
            <label>Â½ Lvl</label>
            <div class="pill-value">
              {{@root.derived.identity.halfLevel}}
            </div>
          </div>

          <!-- Armor (Derived) -->
          <div class="math-pill derived">
            <label>Armor</label>
            <div class="pill-value">
              {{def.armorBonus}}
            </div>
          </div>

          <!-- Ability (Derived) -->
          <div class="math-pill derived">
            <label>Ability</label>
            <div class="pill-value">
              {{def.abilityMod}}
            </div>
          </div>

          <!-- Class (Derived if used) -->
          <div class="math-pill derived">
            <label>Class</label>
            <div class="pill-value">
              {{def.classBonus}}
            </div>
          </div>

          <!-- Misc (Editable) -->
          <div class="math-pill editable">
            <label>Misc</label>
            <input type="number"
                   data-field="misc"
                   name="system.defenses.{{def.key}}.miscMod"
                   value="{{def.miscMod}}">
          </div>

          <div class="math-equals">
            =
          </div>

          <div class="math-result">
            {{def.total}}
          </div>

        </div>

      </div>

    {{/each}}

  </div>

</section>
