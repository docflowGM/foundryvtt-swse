{{!-- ========================================= --}}
{{!-- SWSE V2 ATTACK CARDS (Flip Architecture) --}}
{{!-- ========================================= --}}

<div class="swse-attacks-panel">

  {{#each combat.attacks as |attack|}}
  <div class="swse-attack-card" data-attack-id="{{attack.id}}">
    <div class="card-inner">

      {{!-- ================= FRONT ================= --}}
      <div class="card-front">
        <div class="attack-name">{{attack.name}}</div>

        {{!-- Weapon info from integrated weapons system --}}
        {{#if attack.weaponId}}
        <div class="attack-weapon-info">
          <span class="weapon-name" title="{{attack.weaponName}}">{{attack.weaponName}}</span>
          {{#if attack.weaponType}}
            <span class="weapon-type">({{attack.weaponType}})</span>
          {{/if}}
        </div>
        {{/if}}

        <div class="attack-primary">
          <div class="attack-bonus" data-weapon-id="{{attack.weaponId}}" data-attack-breakdown title="Click for breakdown">
            {{attack.attackTotal}}
          </div>

          <div class="attack-damage" data-weapon-id="{{attack.weaponId}}" data-damage-breakdown title="Click for breakdown">
            {{attack.damageFormula}}
          </div>
        </div>

        <div class="attack-crit">
          Crit {{attack.critRange}}×{{attack.critMult}}
          {{#if attack.weaponProperties}}
            {{#if attack.weaponProperties.keen}}<span class="property-indicator" title="Keen: range +1">⚔</span>{{/if}}
          {{/if}}
        </div>

        <div class="attack-tags">
          {{#each attack.tags}}
            <span class="tag">{{this}}</span>
          {{/each}}
          {{#if attack.weaponProperties}}
            {{#if attack.weaponProperties.flaming}}<span class="tag property-tag">Flaming</span>{{/if}}
            {{#if attack.weaponProperties.frost}}<span class="tag property-tag">Frost</span>{{/if}}
            {{#if attack.weaponProperties.shock}}<span class="tag property-tag">Shock</span>{{/if}}
            {{#if attack.weaponProperties.vorpal}}<span class="tag property-tag">Vorpal</span>{{/if}}
          {{/if}}
        </div>

        <button class="attack-roll-btn" data-action="roll-attack">
          ROLL
        </button>
      </div>

      {{!-- ================= BACK ================= --}}
      <div class="card-back">

        <div class="breakdown-section">
          <div class="section-title">Attack Breakdown</div>
          <div class="pill-row">
            {{#each attack.breakdown.attack}}
              <span class="pill">
                {{label}} {{value}}
              </span>
            {{/each}}
          </div>
        </div>

        <div class="breakdown-section">
          <div class="section-title">Damage Breakdown</div>
          <div class="pill-row">
            {{#each attack.breakdown.damage}}
              <span class="pill">
                {{label}} {{value}}
              </span>
            {{/each}}
          </div>
        </div>

        {{#if attack.breakdown.conditional.length}}
        <div class="breakdown-section">
          <div class="section-title">Conditional</div>
          <div class="pill-row">
            {{#each attack.breakdown.conditional}}
              <span class="pill conditional">
                {{label}} {{value}}
              </span>
            {{/each}}
          </div>
        </div>
        {{/if}}

      </div>

    </div>
  </div>
  {{/each}}

</div>

<style>
.swse-attacks-panel {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 16px;
  padding: 16px;
}

.swse-attack-card {
  perspective: 1000px;
  height: 400px;
  cursor: pointer;
}

.card-inner {
  position: relative;
  width: 100%;
  height: 100%;
  transition: transform 0.6s;
  transform-style: preserve-3d;
}

.swse-attack-card.flipped .card-inner {
  transform: rotateY(180deg);
}

.card-front,
.card-back {
  position: absolute;
  width: 100%;
  height: 100%;
  backface-visibility: hidden;
  display: flex;
  flex-direction: column;
  padding: 16px;
  border: 1px solid #444;
  border-radius: 8px;
  background: linear-gradient(135deg, #1a1a1a 0%, #0d0d0d 100%);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
}

.card-back {
  transform: rotateY(180deg);
  overflow-y: auto;
  background: linear-gradient(135deg, #0d2d5a 0%, #051f47 100%);
}

.attack-name {
  font-size: 16px;
  font-weight: bold;
  color: #fff;
  margin-bottom: 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.attack-weapon-info {
  font-size: 11px;
  color: #aaa;
  margin-bottom: 12px;
  padding: 4px 0;
  border-bottom: 1px solid #333;
}

.weapon-name {
  color: #ff9999;
  font-weight: 600;
}

.weapon-type {
  color: #888;
  margin-left: 4px;
}

.attack-primary {
  display: flex;
  gap: 12px;
  margin-bottom: 12px;
  flex: 1;
}

.attack-bonus,
.attack-damage {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
  background: rgba(0, 0, 0, 0.4);
  border: 2px solid #333;
  border-radius: 6px;
  font-size: 18px;
  font-weight: bold;
  color: #4a9eff;
  cursor: pointer;
  transition: all 0.2s ease;
}

.attack-bonus:hover,
.attack-damage:hover {
  border-color: #4a9eff;
  background: rgba(74, 158, 255, 0.1);
  box-shadow: 0 0 12px rgba(74, 158, 255, 0.3);
}

.attack-crit {
  font-size: 12px;
  color: #888;
  margin-bottom: 8px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 4px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.property-indicator {
  color: #ff9999;
  font-size: 14px;
  font-weight: bold;
}

.attack-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-bottom: 12px;
}

.tag {
  display: inline-block;
  padding: 3px 8px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid #555;
  border-radius: 3px;
  font-size: 10px;
  color: #aaa;
  text-transform: uppercase;
  letter-spacing: 0.3px;
}

.tag.property-tag {
  border-color: #ff9999;
  color: #ff9999;
  background: rgba(255, 153, 153, 0.05);
}

.attack-roll-btn {
  padding: 12px;
  background: linear-gradient(135deg, #ff6b6b 0%, #cc5555 100%);
  border: none;
  border-radius: 6px;
  color: #fff;
  font-weight: bold;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.attack-roll-btn:hover {
  background: linear-gradient(135deg, #ff8080 0%, #dd6666 100%);
  box-shadow: 0 0 16px rgba(255, 107, 107, 0.4);
  transform: scale(1.02);
}

.breakdown-section {
  margin-bottom: 12px;
  padding: 8px;
  background: rgba(0, 0, 0, 0.3);
  border-left: 3px solid #4a9eff;
  border-radius: 3px;
}

.section-title {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: #4a9eff;
  font-weight: bold;
  margin-bottom: 6px;
}

.pill-row {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}

.pill {
  display: inline-block;
  padding: 4px 8px;
  background: rgba(74, 158, 255, 0.1);
  border: 1px solid #4a9eff;
  border-radius: 12px;
  font-size: 10px;
  color: #4a9eff;
  white-space: nowrap;
}

.pill.conditional {
  border-color: #ff9900;
  background: rgba(255, 153, 0, 0.1);
  color: #ff9900;
}

@media (max-width: 768px) {
  .swse-attacks-panel {
    grid-template-columns: 1fr;
  }

  .swse-attack-card {
    height: 350px;
  }
}
</style>
