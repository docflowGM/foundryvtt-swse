
<section class="skills-panel v3-panel holo-panel">

  <header class="section-bar">
    <h3 class="section-header">Skills</h3>

    <div class="skills-toolbar">
      <input type="text"
             class="skill-filter"
             placeholder="Filter skills..."
             data-action="filter-skills">

      <select data-action="sort-skills">
        <option value="default">Default</option>
        <option value="name">Name A–Z</option>
        <option value="total-desc">Total High → Low</option>
        <option value="trained">Trained First</option>
        <option value="favorite">Favorites First</option>
      </select>
    </div>
  </header>

  <div class="skills-table-header">
    <div class="col-star">★</div>
    <div class="col-total">Total</div>
    <div class="col-name">Skill</div>
    <div class="col-ability">Ability</div>
    <div class="col-half">½ Lvl</div>
    <div class="col-trained">T</div>
    <div class="col-focus">F</div>
    <div class="col-misc">Misc</div>
  </div>

  <div class="skills-list">

    {{#each derived.skills as |skill|}}

      <div class="skill-row-container"
           data-skill="{{skill.key}}"
           data-name="{{skill.label}}"
           data-total="{{skill.total}}"
           data-trained="{{skill.trained}}"
           data-favorite="{{skill.favorite}}">

        <div class="skill-row ability-{{skill.selectedAbility}}">

          <div class="col-star">
            <button type="button"
                    class="skill-favorite-toggle {{#if skill.favorite}}active{{/if}}"
                    data-action="toggle-favorite"
                    data-skill="{{skill.key}}">
              ★
            </button>
          </div>

          <div class="col-total rollable"
               data-action="roll-skill"
               data-skill="{{skill.key}}">
            {{numberFormat skill.total decimals=0 sign=true}}
          </div>

          <div class="col-name rollable"
               data-action="roll-skill"
               data-skill="{{skill.key}}">
            {{skill.label}}
          </div>

          <div class="col-ability">
            <select name="system.skills.{{skill.key}}.selectedAbility"
                    class="ability-dropdown">
              {{#each @root.derived.identity.abilities as |ab|}}
                <option value="{{ab.key}}"
                  {{#if (eq ab.key skill.selectedAbility)}}selected{{/if}}>
                  {{ab.label}}
                </option>
              {{/each}}
            </select>
            <span class="ability-mod">
              {{numberFormat skill.abilityMod decimals=0 sign=true}}
            </span>
          </div>

          <div class="col-half">
            {{@root.derived.identity.halfLevel}}
          </div>

          <div class="col-trained">
            <input type="checkbox"
                   name="system.skills.{{skill.key}}.trained"
                   {{checked skill.trained}}>
          </div>

          <div class="col-focus">
            <input type="checkbox"
                   name="system.skills.{{skill.key}}.focused"
                   {{checked skill.focused}}>
          </div>

          <div class="col-misc">
            <input type="number"
                   name="system.skills.{{skill.key}}.miscMod"
                   value="{{skill.miscMod}}">
          </div>

        </div>

        {{#if skill.extraUses.length}}
        <div class="skill-extra-uses">
          {{#each skill.extraUses}}
            <div class="extra-use">
              {{this.label}}
              <button type="button"
                      data-action="use-extra-skill"
                      data-skill="{{../skill.key}}"
                      data-use="{{this.key}}">
                Use
              </button>
            </div>
          {{/each}}
        </div>
        {{/if}}

      </div>

    {{/each}}

  </div>

</section>
