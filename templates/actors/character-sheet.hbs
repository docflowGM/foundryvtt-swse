{{!-- SWSE Character Sheet Template --}}
{{!-- File: templates/actor/character-sheet.hbs --}}

<form class="character-sheet {{cssClass}}" autocomplete="off">
    <div class="character-sheet-inner">
        <div class="header">
            <div>
                <h1>★ Star Wars Saga Edition ★</h1>
                <div class="subtitle">CHARACTER RECORD SHEET</div>
            </div>
            <div class="actions">
                <button type="button" class="save-sheet">Save</button>
                <button type="button" class="load-sheet">Load</button>
            </div>
        </div>

        {{!-- BASIC INFO --}}
        <section class="basic-info">
            <div class="left">
                <div class="field-group">
                    <label>Name</label>
                    <input name="name" type="text" value="{{actor.name}}" />
                </div>

                <div class="field-group">
                    <label>Class(es)</label>
                    <div class="class-list">
                        {{#each system.classes}}
                        <div class="class-row">{{this.name}} (lvl {{this.level}})</div>
                        {{/each}}
                    </div>
                </div>
            </div>

            <div class="middle">
                <div class="field-group">
                    <label>Level</label>
                    <input type="number" name="system.level" value="{{system.level}}" / data-dtype="Number">
                </div>

                <div class="field-group">
                    <label>Species</label>
                    <select name="system.race">
                        {{#each races}}
                        <option value="{{@key}}" {{#if (eq @key ../system.race)}}selected{{/if}}>{{this.name}}</option>
                        {{/each}}
                    </select>
                </div>
            </div>

            <div class="right">
                <div class="field-group">
                    <label>Destiny Points</label>
                    <input type="number" name="system.destinyPoints.value" value="{{system.destinyPoints.value}}" class="tiny-input" / data-dtype="Number">
                </div>

                <div class="field-group">
                    <label>XP</label>
                    <input type="number" name="system.experience" value="{{system.experience}}" / data-dtype="Number">
                </div>
            </div>
        </section>

        {{!-- MAIN LAYOUT --}}
        <section class="main-layout">
            {{!-- Left: Abilities --}}
            <aside class="abilities-box">
                <div class="section-title">Abilities</div>
                
                {{#each system.abilities}}
                <div class="ability-row">
                    <div class="ability-label">{{uppercase @key}}</div>
                    <input type="number" name="system.abilities.{{@key}}.base" value="{{this.base}}" class="ability-input" / data-dtype="Number">
                    <div class="ability-total">Tot: {{this.total}}</div>
                    <div class="ability-mod">Mod: {{#if (gte this.mod 0)}}+{{/if}}{{this.mod}}</div>
                </div>
                {{/each}}
            </aside>

            {{!-- Middle: Combat Stats --}}
            <section class="combat-box">
                <div class="stat-row compact-halflvl">
                    <label>½ Level</label>
                    <div class="half-value">{{halfLevel}}</div>
                </div>

                <div class="hp-block">
                    <div class="hp-row">
                        <label>HP</label>
                        <input type="number" name="system.hp.value" value="{{system.hp.value}}" class="hp-small" / data-dtype="Number">
                        <span>/</span>
                        <input type="number" name="system.hp.max" value="{{system.hp.max}}" class="hp-small" / data-dtype="Number">
                        <label>Temp</label>
                        <input type="number" name="system.hp.temp" value="{{system.hp.temp}}" class="hp-small" / data-dtype="Number">
                    </div>

                    <div class="hp-actions">
                        <label>Base Attack</label>
                        <input type="number" name="system.bab" value="{{system.bab}}" class="tiny-input" / data-dtype="Number">
                        <label>Speed</label>
                        <input type="number" name="system.speed.base" value="{{system.speed.base}}" class="tiny-input" / data-dtype="Number">
                    </div>
                </div>

                <div class="force-and-dt">
                    <div class="force-block">
                        <label>Force Points</label>
                        <input type="number" name="system.forcePoints.value" value="{{system.forcePoints.value}}" class="fp-small" / data-dtype="Number">
                        <span>/</span>
                        <input type="number" name="system.forcePoints.max" value="{{system.forcePoints.max}}" class="fp-small" / data-dtype="Number">
                        <select name="system.forcePoints.die" class="fp-die">
                            <option value="1d6" {{#if (eq system.forcePoints.die "1d6")}}selected{{/if}}>1d6</option>
                            <option value="1d8" {{#if (eq system.forcePoints.die "1d8")}}selected{{/if}}>1d8</option>
                            <option value="1d10" {{#if (eq system.forcePoints.die "1d10")}}selected{{/if}}>1d10</option>
                        </select>
                        <div class="force-note">Base die used when spending FP</div>
                    </div>

                    <div class="dt-block">
                        <label>Damage Threshold</label>
                        <div class="dt-value">{{damageThreshold}}</div>
                        <label>Misc Modifier</label>
                        <input type="number" name="system.damageThresholdMisc" value="{{system.damageThresholdMisc}}" class="tiny-input" / data-dtype="Number">
                    </div>
                </div>
            </section>

            {{!-- Right: Defenses --}}
            <aside class="combat-right">
                <div class="section-title">Defenses</div>
                
                <div class="def-row">
                    <label>FORTITUDE</label>
                    <div class="def-value">{{system.defenses.fortitude.total}}</div>
                </div>

                <div class="def-row">
                    <label>REFLEX</label>
                    <div class="def-value">{{system.defenses.reflex.total}}</div>
                </div>

                <div class="def-row">
                    <label>WILL</label>
                    <div class="def-value">{{system.defenses.will.total}}</div>
                </div>

                <div class="condition-box">
                    <label>Condition Track</label>
                    <select name="system.conditionTrack">
                        <option value="normal" {{#if (eq system.conditionTrack "normal")}}selected{{/if}}>Normal</option>
                        <option value="-1" {{#if (eq system.conditionTrack "-1")}}selected{{/if}}>-1 (Minor)</option>
                        <option value="-2" {{#if (eq system.conditionTrack "-2")}}selected{{/if}}>-2 (Hurt)</option>
                        <option value="-5" {{#if (eq system.conditionTrack "-5")}}selected{{/if}}>-5 (Wounded)</option>
                        <option value="-10" {{#if (eq system.conditionTrack "-10")}}selected{{/if}}>-10 (Disabled)</option>
                        <option value="helpless" {{#if (eq system.conditionTrack "helpless")}}selected{{/if}}>Helpless</option>
                    </select>
                </div>

                <div class="second-wind-box">
                    <div class="section-title">Second Wind</div>
                    <div style="margin-bottom: 8px;">Auto healing: <strong>{{system.secondWind.healing}}</strong></div>
                    <div class="field-group">
                        <label>Misc Modifier</label>
                        <input type="number" name="system.secondWind.misc" value="{{system.secondWind.misc}}" class="tiny-input" / data-dtype="Number">
                    </div>
                    <div class="field-group">
                        <label>Uses</label>
                        <input type="number" name="system.secondWind.uses" value="{{system.secondWind.uses}}" class="tiny-input" / data-dtype="Number">
                    </div>
                    <div class="field-group">
                        <label>Max/day</label>
                        <input type="number" name="system.secondWind.max" value="{{system.secondWind.max}}" class="tiny-input" / data-dtype="Number">
                    </div>
                    <button type="button" class="apply-second-wind">Take Second Wind</button>
                </div>
            </aside>
        </section>

        {{!-- TABS --}}
        <section class="tabs">
            <div class="tab-row">
                <button type="button" class="tab active" data-tab="armor">Armor & Equipment</button>
                <button type="button" class="tab" data-tab="feats">Feats & Talents</button>
                <button type="button" class="tab" data-tab="powers">Force Powers</button>
                <button type="button" class="tab" data-tab="weapons">Weapons</button>
            </div>

            {{!-- ARMOR TAB --}}
            <div class="tab-content armor active" id="armor-tab">
                <button type="button" class="add-armor">+ Add Armor</button>
                <div class="list-armor">
                    {{#each armor}}
                    <div class="armor-entry" data-item-id="{{this._id}}">
                        <div class="item-header">
                            <strong>{{this.name}}</strong>
                            <div>
                                <button type="button" class="item-edit" title="Edit"><i class="fas fa-edit"></i></button>
                                <button type="button" class="item-delete" title="Delete"><i class="fas fa-trash"></i></button>
                            </div>
                        </div>
                        <div class="item-details">
                            {{#if this.system.reflexBonus}}Reflex: +{{this.system.reflexBonus}}{{/if}}
                            {{#if this.system.maxDex}}Max Dex: {{this.system.maxDex}}{{/if}}
                        </div>
                    </div>
                    {{/each}}
                </div>

                <div style="margin-top: 20px;">
                    <h3>Equipment</h3>
                    <button type="button" class="add-equipment">+ Add Equipment</button>
                    <div class="list-equipment">
                        {{#each equipment}}
                        <div class="equipment-entry" data-item-id="{{this._id}}">
                            <div class="item-header">
                                <strong>{{this.name}}</strong>
                                <div>
                                    <button type="button" class="item-edit" title="Edit"><i class="fas fa-edit"></i></button>
                                    <button type="button" class="item-delete" title="Delete"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                        {{/each}}
                    </div>
                </div>
            </div>

            {{!-- FEATS TAB --}}
            <div class="tab-content feats" id="feats-tab">
                <div class="two-column">
                    <div>
                        <h3>Feats</h3>
                        <button type="button" class="add-feat">+ Add Feat</button>
                        <div class="feats-list">
                            {{#each feats}}
                            <div class="feat-entry" data-item-id="{{this._id}}">
                                <div class="item-header">
                                    <strong>{{this.name}}</strong>
                                    <div>
                                        <button type="button" class="item-edit" title="Edit"><i class="fas fa-edit"></i></button>
                                        <button type="button" class="item-delete" title="Delete"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                                {{#if this.system.description}}
                                <div class="item-description">{{this.system.description}}</div>
                                {{/if}}
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    
                    <div>
                        <h3>Talents</h3>
                        <button type="button" class="add-talent">+ Add Talent</button>
                        <div class="talents-list">
                            {{#each talents}}
                            <div class="talent-entry" data-item-id="{{this._id}}">
                                <div class="item-header">
                                    <strong>{{this.name}}</strong>
                                    <div>
                                        <button type="button" class="item-edit" title="Edit"><i class="fas fa-edit"></i></button>
                                        <button type="button" class="item-delete" title="Delete"><i class="fas fa-trash"></i></button>
                                    </div>
                                </div>
                                {{#if this.system.description}}
                                <div class="item-description">{{this.system.description}}</div>
                                {{/if}}
                            </div>
                            {{/each}}
                        </div>
                    </div>
                </div>
            </div>

            {{!-- FORCE POWERS TAB --}}
            <div class="tab-content powers" id="powers-tab">
                <button type="button" class="refresh-forcepowers">Refresh All Powers</button>
                
                {{#each forcePowers}}
                <div class="forcepower-entry" data-item-id="{{this._id}}">
                    <div class="power-header">
                        {{this.name}} 
                        {{#if this.system.uses}}
                        ({{this.system.uses.current}}/{{this.system.uses.max}} uses)
                        {{/if}}
                    </div>
                    <div class="power-actions">
                        <button type="button" class="roll-forcepower">Use Power</button>
                        <button type="button" class="reload-forcepower">Reload (1 FP)</button>
                        <button type="button" class="item-edit" title="Edit"><i class="fas fa-edit"></i></button>
                        <button type="button" class="item-delete" title="Delete"><i class="fas fa-trash"></i></button>
                    </div>
                    {{#if this.system.description}}
                    <div class="item-description">{{this.system.description}}</div>
                    {{/if}}
                </div>
                {{/each}}
            </div>

            {{!-- WEAPONS TAB --}}
            <div class="tab-content weapons" id="weapons-tab">
                <button type="button" class="add-weapon">+ Add Weapon</button>
                
                {{#each weapons}}
                <div class="weapon-entry" data-item-id="{{this._id}}">
                    <div class="weapon-header">
                        <strong>{{this.name}}</strong>
                        <div>
                            <button type="button" class="item-edit" title="Edit"><i class="fas fa-edit"></i></button>
                            <button type="button" class="item-delete" title="Delete"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="weapon-stats">
                        {{#if this.system.damage}}Damage: {{this.system.damage}}{{/if}}
                        {{#if this.system.range}}Range: {{this.system.range}}{{/if}}
                        {{#if this.system.crit}}Crit: {{this.system.crit}}{{/if}}
                    </div>
                    <button type="button" class="roll-weapon">Attack Roll</button>
                </div>
                {{/each}}
            </div>
        </section>

        <footer class="sheet-footer">
            <small>Star Wars Saga Edition — Character Sheet v1.0</small>
        </footer>
    </div>
</form>

<style>
/* Keep your existing CSS here - all the styles from the HTML artifact */
* { margin: 0; padding: 0; box-sizing: border-box; }

.character-sheet {
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #e8e8e8 0%, #d4d4d4 100%);
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    position: relative;
}

.character-sheet::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 8px;
    background: linear-gradient(90deg, #4a4a4a, #6a6a6a, #4a4a4a);
}

.header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 25px;
    padding-bottom: 15px;
    border-bottom: 3px solid #4a4a4a;
}

.header h1 {
    font-size: 20px;
    letter-spacing: 3px;
    color: #2a2a2a;
    text-transform: uppercase;
}

.header .subtitle {
    font-size: 10px;
    color: #666;
    letter-spacing: 2px;
    text-transform: uppercase;
}

.header .actions {
    display: flex;
    gap: 8px;
}

.header .actions button {
    background: linear-gradient(135deg, #4a90e2, #357abd);
    border: 2px solid #2a5a8d;
    border-radius: 4px;
    color: white;
    padding: 6px 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 10px;
}

.basic-info {
    display: grid;
    grid-template-columns: 2fr 1.5fr 1fr;
    gap: 15px;
    margin-bottom: 20px;
}

.basic-info .left,
.basic-info .middle,
.basic-info .right {
    background: rgba(255,255,255,0.3);
    padding: 12px;
    border-radius: 6px;
    border: 2px solid #666;
}

.field-group {
    margin-bottom: 10px;
}

.field-label, label {
    font-size: 9px;
    font-weight: bold;
    text-transform: uppercase;
    color: #555;
    display: block;
    margin-bottom: 3px;
}

input[type="text"], input[type="number"], select {
    width: 100%;
    background: white;
    border: 2px solid #666;
    border-radius: 4px;
    padding: 6px 8px;
    font-size: 13px;
    font-weight: 500;
    box-shadow: inset 2px 2px 4px rgba(0,0,0,0.1);
}

.tiny-input {
    width: 60px !important;
}

.class-list {
    background: white;
    border: 2px solid #666;
    border-radius: 4px;
    padding: 8px;
    min-height: 40px;
}

.class-row {
    font-size: 12px;
    padding: 4px;
    background: rgba(74, 144, 226, 0.1);
    margin-bottom: 4px;
    border-radius: 3px;
}

.main-layout {
    display: grid;
    grid-template-columns: 260px 1fr 280px;
    gap: 20px;
    margin-bottom: 20px;
}

.abilities-box, .combat-box, .combat-right {
    background: linear-gradient(135deg, #b8b8b8, #c8c8c8);
    border: 3px solid #4a4a4a;
    border-radius: 8px;
    padding: 12px;
    box-shadow: 4px 4px 8px rgba(0,0,0,0.2);
}

.section-title {
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    color: #2a2a2a;
    margin-bottom: 10px;
    text-align: center;
    letter-spacing: 1px;
    border-bottom: 2px solid #4a4a4a;
    padding-bottom: 5px;
}

.ability-row {
    display: grid;
    grid-template-columns: 35px 60px 60px 60px;
    gap: 6px;
    margin-bottom: 8px;
    align-items: center;
}

.ability-label {
    font-size: 11px;
    font-weight: bold;
    color: #2a2a2a;
    text-transform: uppercase;
}

.ability-input {
    background: white;
    border: 2px solid #555;
    border-radius: 3px;
    padding: 6px;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
    width: 100%;
}

.ability-total, .ability-mod {
    background: linear-gradient(135deg, #666, #555);
    color: white;
    border: 2px solid #333;
    border-radius: 3px;
    padding: 6px;
    text-align: center;
    font-size: 11px;
    font-weight: bold;
}

.stat-row {
    text-align: center;
    margin-bottom: 15px;
}

.half-value {
    background: white;
    border: 3px solid #555;
    border-radius: 6px;
    padding: 10px;
    font-size: 20px;
    font-weight: bold;
    text-align: center;
    box-shadow: inset 2px 2px 4px rgba(0,0,0,0.15);
    margin-top: 5px;
}

.hp-block, .force-and-dt {
    background: rgba(255,255,255,0.3);
    padding: 12px;
    border-radius: 6px;
    margin-bottom: 12px;
}

.hp-row {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    flex-wrap: wrap;
}

.hp-small {
    width: 70px;
    padding: 6px;
    text-align: center;
}

.hp-actions {
    display: grid;
    grid-template-columns: auto 1fr auto 1fr;
    gap: 8px;
    align-items: center;
}

.fp-small {
    width: 50px;
    padding: 4px;
    text-align: center;
    display: inline-block;
}

.fp-die {
    width: 70px;
    padding: 4px;
    margin-left: 5px;
}

.force-note {
    font-size: 9px;
    font-style: italic;
    color: #666;
    margin-top: 4px;
}

.dt-value {
    background: white;
    border: 2px solid #555;
    border-radius: 4px;
    padding: 8px;
    font-size: 18px;
    font-weight: bold;
    text-align: center;
    margin: 5px 0;
}

.def-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 12px;
    background: rgba(255,255,255,0.3);
    border-radius: 4px;
    margin-bottom: 8px;
}

.def-row label {
    font-size: 12px;
    font-weight: bold;
    color: #2a2a2a;
}

.def-value {
    background: linear-gradient(135deg, #666, #555);
    color: white;
    border: 2px solid #333;
    padding: 8px 16px;
    border-radius: 4px;
    font-weight: bold;
    font-size: 16px;
}

.condition-box {
    margin-top: 15px;
    padding: 12px;
    background: linear-gradient(135deg, #d44, #b33);
    border: 3px solid #4a4a4a;
    border-radius: 6px;
}

.condition-box label {
    color: white;
    margin-bottom: 8px;
}

.condition-box select {
    width: 100%;
    padding: 8px;
    font-weight: bold;
}

.second-wind-box {
    margin-top: 15px;
    padding: 12px;
    background: linear-gradient(135deg, #f7e6e6, #f2dede);
    border: 3px solid #a44;
    border-radius: 6px;
}

.second-wind-box .section-title {
    font-size: 10px;
    color: #822;
    border-bottom-color: #a44;
}

.apply-second-wind {
    width: 100%;
    margin-top: 10px;
    padding: 8px;
    background: linear-gradient(135deg, #4a90e2, #357abd);
    border: 2px solid #2a5a8d;
    border-radius: 4px;
    color: white;
    font-weight: bold;
    cursor: pointer;
}

.tabs {
    margin-top: 20px;
}

.tab-row {
    display: flex;
    gap: 5px;
    margin-bottom: 0;
    border-bottom: 3px solid #4a4a4a;
}

.tab {
    background: linear-gradient(135deg, #999, #888);
    border: 2px solid #4a4a4a;
    border-bottom: none;
    border-radius: 6px 6px 0 0;
    padding: 8px 16px;
    font-size: 11px;
    font-weight: bold;
    text-transform: uppercase;
    cursor: pointer;
    color: #2a2a2a;
}

.tab.active {
    background: linear-gradient(135deg, #c8c8c8, #b8b8b8);
    transform: translateY(2px);
}

.tab-content {
    display: none;
    background: linear-gradient(135deg, #b8b8b8, #c8c8c8);
    border: 3px solid #4a4a4a;
    border-radius: 0 8px 8px 8px;
    padding: 15px;
    min-height: 300px;
    max-height: 600px;
    overflow-y: auto;
}

.tab-content.active {
    display: block;
}

.add-armor, .add-feat, .add-weapon, .add-equipment, .add-talent, .refresh-forcepowers {
    background: linear-gradient(135deg, #4a90e2, #357abd);
    border: 2px solid #2a5a8d;
    border-radius: 4px;
    color: white;
    padding: 8px 16px;
    cursor: pointer;
    font-weight: bold;
    font-size: 11px;
    margin-bottom: 12px;
}

.armor-entry, .feat-entry, .forcepower-entry, .weapon-entry, .equipment-entry, .talent-entry {
    background: rgba(255,255,255,0.4);
    border: 2px solid #666;
    border-radius: 4px;
    padding: 10px;
    margin-bottom: 8px;
}

.item-header, .weapon-header, .power-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
}

.item-edit, .item-delete {
    background: transparent;
    border: none;
    cursor: pointer;
    padding: 4px;
    margin-left: 4px;
}

.item-description {
    font-size: 11px;
    color: #555;
    margin-top: 6px;
    padding: 6px;
    background: rgba(255,255,255,0.5);
    border-radius: 3px;
}

.roll-forcepower, .reload-forcepower, .roll-weapon {
    background: linear-gradient(135deg, #4a90e2, #357abd);
    border: 2px solid #2a5a8d;
    border-radius: 3px;
    color: white;
    padding: 6px 12px;
    cursor: pointer;
    font-weight: bold;
    font-size: 10px;
    margin-right: 6px;
}

.two-column {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.sheet-footer {
    margin-top: 20px;
    padding-top: 10px;
    border-top: 2px solid #4a4a4a;
    text-align: center;
    font-size: 10px;
    color: #666;
}
</style>