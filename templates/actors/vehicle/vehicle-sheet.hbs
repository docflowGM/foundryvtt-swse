{{!-- Level 3 HUD â€“ vehicle-sheet.hbs --}}
<div class="vehicle-sheet">
<form class="{{cssClass}} swse-vehicle-sheet" autocomplete="off">

  {{!-- Ship Header with Editable Fields --}}
  <header class="vehicle-header">
    <div class="header-left">
      {{!-- Ship Image --}}
      <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" width="100" height="100"/>

      {{!-- Ship Name --}}
      <div class="ship-name">
        <input name="name" type="text" value="{{actor.name}}" placeholder="Ship Name"/>
      </div>
    </div>

    <div class="header-center">
      {{!-- Hull Points --}}
      <div class="resource hull-points">
        <label>Hull Points</label>
        <div class="resource-bar">
          <input type="number" name="system.hull.value" value="{{system.hull.value}}" data-dtype="Number" class="resource-input"/>
          <span class="separator">/</span>
          <input type="number" name="system.hull.max" value="{{system.hull.max}}" data-dtype="Number" class="resource-max-input"/>
        </div>
      </div>

      {{!-- Shield Rating --}}
      <div class="resource shield-rating">
        <label>Shield Rating (SR)</label>
        <div class="resource-bar">
          <input type="number" name="system.shields.value" value="{{system.shields.value}}" data-dtype="Number" class="resource-input"/>
          <span class="separator">/</span>
          <input type="number" name="system.shields.max" value="{{system.shields.max}}" data-dtype="Number" class="resource-max-input"/>
        </div>
      </div>
    </div>

    <div class="header-right">
      {{!-- Export Control --}}
      <button class="export-character-json-btn vehicle-export-btn" title="Export Ship to JSON" role="button" tabindex="0">
        <i class="fas fa-download" aria-hidden="true"></i> Export
      </button>
    </div>
  </header>

  {{!-- Vehicle Stats Input Section --}}
  <section class="vehicle-stats-inputs">
    <div class="stats-grid">
      <div class="stat-input">
        <label>Speed</label>
        <input type="text" name="system.speed" value="{{system.speed}}" placeholder="12 squares"/>
      </div>

      <div class="stat-input">
        <label>Max Velocity</label>
        <input type="text" name="system.maxVelocity" value="{{system.maxVelocity}}" placeholder="800 km/h"/>
      </div>

      <div class="stat-input">
        <label>Maneuver</label>
        <input type="text" name="system.maneuver" value="{{system.maneuver}}" placeholder="+0"/>
      </div>

      <div class="stat-input">
        <label>Damage Reduction</label>
        <input type="number" name="system.damageReduction" value="{{system.damageReduction}}" data-dtype="Number" placeholder="0"/>
      </div>
    </div>

    {{!-- Defensive Statistics --}}
    <h4 class="stats-section-title">Defensive Statistics</h4>
    <div class="stats-grid">
      <div class="stat-display">
        <label>Reflex Defense</label>
        <span class="value">{{system.reflexDefense}}</span>
      </div>

      <div class="stat-display">
        <label>Fortitude Defense</label>
        <span class="value">{{system.fortitudeDefense}}</span>
      </div>

      <div class="stat-display">
        <label>Damage Threshold</label>
        <span class="value">{{system.damageThreshold}}</span>
      </div>

      <div class="stat-input">
        <label>Armor Bonus</label>
        <input type="number" name="system.armorBonus" value="{{system.armorBonus}}" data-dtype="Number" placeholder="0"/>
      </div>
    </div>

    {{!-- Attack & Combat Statistics --}}
    <h4 class="stats-section-title">Attack & Combat Statistics</h4>
    <div class="stats-grid">
      <div class="stat-display">
        <label>Attack Bonus</label>
        <span class="value">{{#if (eq system.attackBonus 0)}}{{system.attackBonus}}{{else}}{{#if (gt system.attackBonus 0)}}+{{/if}}{{system.attackBonus}}{{/if}}</span>
      </div>

      <div class="stat-display">
        <label>Grapple Modifier</label>
        <span class="value">{{#if (eq system.grappleModifier 0)}}{{system.grappleModifier}}{{else}}{{#if (gt system.grappleModifier 0)}}+{{/if}}{{system.grappleModifier}}{{/if}}</span>
      </div>

      <div class="stat-display">
        <label>Perception</label>
        <span class="value">{{#if (eq system.perception 0)}}{{system.perception}}{{else}}{{#if (gt system.perception 0)}}+{{/if}}{{system.perception}}{{/if}}</span>
      </div>

      <div class="stat-input">
        <label>Challenge Level</label>
        <input type="number" name="system.challengeLevel" value="{{system.challengeLevel}}" data-dtype="Number" placeholder="1"/>
      </div>
    </div>

    {{!-- Vehicle Information --}}
    <h4 class="stats-section-title">Vehicle Information</h4>
    <div class="stats-grid">
      <div class="stat-input">
        <label>Passengers</label>
        <input type="text" name="system.passengers" value="{{system.passengers}}" placeholder="0"/>
      </div>

      <div class="stat-input">
        <label>Cargo Capacity</label>
        <input type="text" name="system.cargo" value="{{system.cargo}}" placeholder="100 kg"/>
      </div>

      <div class="stat-input">
        <label>Cover Type</label>
        <select name="system.cover">
          <option value="none" {{#if (eq system.cover "none")}}selected{{/if}}>None</option>
          <option value="normal" {{#if (eq system.cover "normal")}}selected{{/if}}>Normal (+5)</option>
          <option value="improved" {{#if (eq system.cover "improved")}}selected{{/if}}>Improved (+10)</option>
          <option value="total" {{#if (eq system.cover "total")}}selected{{/if}}>Total Cover</option>
        </select>
      </div>

      <div class="stat-input">
        <label>Hyperdrive</label>
        <input type="text" name="system.hyperdrive" value="{{system.hyperdrive}}" placeholder="x1"/>
      </div>
    </div>

    {{!-- Optional Fields --}}
    <h4 class="stats-section-title">Optional Information</h4>
    <div class="stats-grid">
      <div class="stat-input">
        <label>Payload</label>
        <input type="text" name="system.payload" value="{{system.payload}}" placeholder="e.g., 6 Proton Torpedoes"/>
      </div>

      <div class="stat-input">
        <label>Availability</label>
        <input type="text" name="system.availability" value="{{system.availability}}" placeholder="Restricted/Legal"/>
      </div>
    </div>
  </section>

  {{!-- Visual HUD Display --}}
  <div class="vehicle-center">

    {{!-- Holographic ship image + scanner + damage overlays --}}
    {{> "vehicle-image" actor=actor }}

    {{!-- HUD callouts (holographic stat tiles) --}}
    {{> "vehicle-callouts" actor=actor }}

  </div>

  {{!-- Crew Positions Section --}}
  <section class="crew-positions-section">
    <h3>
      Crew Positions
      {{#if pilotSoloMode}}
      <span class="solo-mode-badge" title="{{pilotSoloMode.message}}">
        <i class="fas fa-star"></i> Solo Pilot
      </span>
      {{/if}}
    </h3>

    {{#if crewRoster.positions}}
    <div class="crew-grid">
      {{#each crewRoster.positions as |posData posKey|}}
      <div class="crew-position">
        <div class="position-header">
          <label>{{posData.display}}</label>
          {{#if posData.crew}}
          <span class="crew-status-badge trained">Assigned</span>
          {{else}}
          <span class="crew-status-badge empty">Empty</span>
          {{/if}}
        </div>

        <div class="crew-slot" data-slot="{{posKey}}">
          {{#if posData.crew}}
            <span class="crew-name">{{posData.crew.name}}</span>
            <button class="crew-remove" type="button" title="Remove crew member">
              <i class="fas fa-times"></i>
            </button>
          {{else}}
            <span class="crew-empty">Drop actor here</span>
          {{/if}}
        </div>

        {{!-- Crew Skills Display --}}
        {{#if posData.skills}}
        <div class="crew-skills">
          {{#each posData.skills as |skill|}}
          <div class="skill-item {{if skill.required 'required' 'beneficial'}} {{if skill.trained 'trained' ''}}">
            <span class="skill-name">{{skill.name}}</span>
            <span class="skill-bonus {{if (gt skill.bonus 0) 'positive' ''}} {{if (lt skill.bonus 0) 'negative' ''}}">
              {{#if (gt skill.bonus 0)}}+{{/if}}{{skill.bonus}}
            </span>
            {{#if skill.trained}}
            <span class="trained-badge" title="Trained in this skill">T</span>
            {{/if}}
            {{#if skill.required}}
            <span class="required-badge" title="Required for this position">*</span>
            {{/if}}
          </div>
          {{/each}}
        </div>
        {{/if}}

        {{!-- Starship Maneuver Suite for Pilot --}}
        {{#if posData.maneuverSuite}}
        {{#if posData.maneuverSuite.hasStartshipTactics}}
        <div class="crew-maneuvers">
          <button class="crew-maneuvers-toggle" type="button" title="Starship Maneuver Suite">
            <i class="fas fa-chevron-right"></i> Maneuver Suite ({{posData.maneuverSuite.total}})
          </button>
          <div class="crew-maneuvers-list" style="display: none;">
            {{#if posData.maneuverSuite.total}}
              {{!-- Attack Patterns --}}
              {{#if posData.maneuverSuite.organized.attackPatterns}}
              {{#if posData.maneuverSuite.organized.attackPatterns.length}}
              <div class="maneuver-category">
                <h5 class="category-title">Attack Patterns</h5>
                {{#each posData.maneuverSuite.organized.attackPatterns as |maneuver|}}
                <div class="maneuver-item">
                  <strong>{{maneuver.name}}</strong>
                  {{#if maneuver.description}}
                  <p class="maneuver-desc">{{maneuver.description}}</p>
                  {{/if}}
                </div>
                {{/each}}
              </div>
              {{/if}}
              {{/if}}

              {{!-- Dogfighting --}}
              {{#if posData.maneuverSuite.organized.dogfight}}
              {{#if posData.maneuverSuite.organized.dogfight.length}}
              <div class="maneuver-category">
                <h5 class="category-title">Dogfighting</h5>
                {{#each posData.maneuverSuite.organized.dogfight as |maneuver|}}
                <div class="maneuver-item">
                  <strong>{{maneuver.name}}</strong>
                  {{#if maneuver.description}}
                  <p class="maneuver-desc">{{maneuver.description}}</p>
                  {{/if}}
                </div>
                {{/each}}
              </div>
              {{/if}}
              {{/if}}

              {{!-- Force --}}
              {{#if posData.maneuverSuite.organized.force}}
              {{#if posData.maneuverSuite.organized.force.length}}
              <div class="maneuver-category">
                <h5 class="category-title force-category">Force Maneuvers</h5>
                {{#each posData.maneuverSuite.organized.force as |maneuver|}}
                <div class="maneuver-item">
                  <strong>{{maneuver.name}}</strong>
                  {{#if maneuver.description}}
                  <p class="maneuver-desc">{{maneuver.description}}</p>
                  {{/if}}
                </div>
                {{/each}}
              </div>
              {{/if}}
              {{/if}}

              {{!-- Gunner --}}
              {{#if posData.maneuverSuite.organized.gunner}}
              {{#if posData.maneuverSuite.organized.gunner.length}}
              <div class="maneuver-category">
                <h5 class="category-title gunner-category">Gunner Maneuvers</h5>
                {{#each posData.maneuverSuite.organized.gunner as |maneuver|}}
                <div class="maneuver-item">
                  <strong>{{maneuver.name}}</strong>
                  {{#if maneuver.description}}
                  <p class="maneuver-desc">{{maneuver.description}}</p>
                  {{/if}}
                </div>
                {{/each}}
              </div>
              {{/if}}
              {{/if}}

              {{!-- General --}}
              {{#if posData.maneuverSuite.organized.general}}
              {{#if posData.maneuverSuite.organized.general.length}}
              <div class="maneuver-category">
                <h5 class="category-title">General</h5>
                {{#each posData.maneuverSuite.organized.general as |maneuver|}}
                <div class="maneuver-item">
                  <strong>{{maneuver.name}}</strong>
                  {{#if maneuver.description}}
                  <p class="maneuver-desc">{{maneuver.description}}</p>
                  {{/if}}
                </div>
                {{/each}}
              </div>
              {{/if}}
              {{/if}}
            {{else}}
              <div class="no-maneuvers-notice">
                Pilot has no maneuvers selected in their suite.
              </div>
            {{/if}}
          </div>
        </div>
        {{else}}
        <div class="crew-maneuvers-notice">
          <small>Requires Starship Tactics feat</small>
        </div>
        {{/if}}
        {{/if}}

        {{!-- Crew Actions Toggle --}}
        {{#if posData.actions}}
        {{#if (or posData.actions.swift.length posData.actions.move.length posData.actions.standard.length posData.actions.fullRound.length posData.actions.reaction.length)}}
        <button class="crew-actions-toggle" type="button">
          <i class="fas fa-chevron-down"></i> Actions
        </button>
        <div class="crew-actions-panel" style="display: none;">
          {{> "crew-action-cards" actions=posData.actions position=posKey}}
        </div>
        {{/if}}
        {{/if}}
      </div>
      {{/each}}
    </div>
    {{/if}}
  </section>

  {{!-- Weapons Section --}}
  <section class="weapons-section">
    <h3>
      Weapons
      <button class="weapon-add" type="button" title="Add weapon">
        <i class="fas fa-plus"></i> Add Weapon
      </button>
    </h3>
    <div class="weapons-list">
      {{#each system.weapons as |weapon index|}}
      <div class="weapon-item">
        <input type="text" name="system.weapons.{{index}}.name" value="{{weapon.name}}" placeholder="Weapon Name"/>

        <select name="system.weapons.{{index}}.arc">
          <option value="Forward" {{#if (eq weapon.arc "Forward")}}selected{{/if}}>Forward</option>
          <option value="Aft" {{#if (eq weapon.arc "Aft")}}selected{{/if}}>Aft</option>
          <option value="Port" {{#if (eq weapon.arc "Port")}}selected{{/if}}>Port</option>
          <option value="Starboard" {{#if (eq weapon.arc "Starboard")}}selected{{/if}}>Starboard</option>
          <option value="Turret" {{#if (eq weapon.arc "Turret")}}selected{{/if}}>Turret</option>
        </select>

        <input type="text" name="system.weapons.{{index}}.bonus" value="{{weapon.bonus}}" placeholder="+0" class="weapon-bonus"/>
        <input type="text" name="system.weapons.{{index}}.damage" value="{{weapon.damage}}" placeholder="0d0" class="weapon-damage"/>
        <input type="text" name="system.weapons.{{index}}.range" value="{{weapon.range}}" placeholder="Close" class="weapon-range"/>

        <button class="weapon-roll" data-index="{{index}}" type="button" title="Roll attack">
          <i class="fas fa-dice-d20"></i>
        </button>

        <button class="weapon-remove" data-index="{{index}}" type="button" title="Remove weapon">
          <i class="fas fa-trash"></i>
        </button>
      </div>
      {{/each}}
    </div>
  </section>

</form>
</div>
