{{!-- Updated SWSE Character Sheet (generated by swse_sheet_updater.py) --}}
<div class="character-sheet">
  <div class="header">
    <h1>★ Star Wars Saga Edition ★ — {{name}}</h1>
    <div class="subtitle">CHARACTER RECORD SHEET</div>
    <div class="actions">
      <button class="save-sheet">Save (flags)</button>
      <button class="load-sheet">Load (flags)</button>
    </div>
  </div>

  <section class="basic-info">
    <div class="left">
      <label>Name</label>
      <input name="name" value="{{name}}" />

      <label>Class(es)</label>
      <div class="class-list">
        {{#each system.classes}}
          <div class="class-row">{{this.name}} (lvl {{this.level}})</div>
        {{/each}}
      </div>
    </div>

    <div class="middle">
      <label>Level</label>
      <input type="number" name="system.level" value="{{system.level}}" />

      <label>Species</label>
      <select name="system.race" class="species-select">
        {{#each races}}
          <option value="{{@key}}" {{#if (eq @key ../system.race)}}selected{{/if}}>{{this.name}}</option>
        {{/each}}
      </select>
    </div>

    <div class="right">
      <label>Destiny</label>
      <input type="number" name="system.destinyPoints.value" value="{{system.destinyPoints.value}}" class="tiny-input" />
    </div>
  </section>

  <section class="main-layout">
    <aside class="abilities-box">
      <div class="section-title">Abilities</div>
      {{!-- show each ability with base + racial + total --}}
      {{#each system.abilities}}
        <div class="ability-row">
          <div class="ability-label">{{uppercase @key}}</div>
          <input type="number" name="system.abilities.{{@key}}.base" value="{{this.base}}" class="ability-input"/>
          <div class="ability-total">Tot: {{this.total}}</div>
          <div class="ability-mod">Mod: {{this.mod}}</div>
        </div>
      {{/each}}
    </aside>

    <section class="combat-box">
      <div class="stat-row compact-halflvl">
        <label>½ Level</label>
        <div class="half-value">{{mathFloor (div system.level 2)}}</div>
      </div>

      <div class="hp-block">
        <div class="hp-row">
          <label>HP</label>
          <input type="number" name="system.hp.value" value="{{system.hp.value}}" class="hp-small" />
          <span>/</span>
          <input type="number" name="system.hp.max" value="{{system.hp.max}}" class="hp-small" />
          <label>Temp</label>
          <input type="number" name="system.hp.temp" value="{{system.hp.temp}}" class="hp-small" />
        </div>

        <div class="hp-actions">
          <label>Base Attack</label>
          <input type="number" name="system.bab" value="{{system.bab}}" class="tiny-input" />
          <label>Speed</label>
          <input type="number" name="system.speed.base" value="{{system.speed.base}}" class="tiny-input" />
        </div>
      </div>

      <div class="force-and-dt">
        <div class="force-block">
          <label>Force Points</label>
          <input type="number" name="system.forcePoints.value" value="{{system.forcePoints.value}}" class="fp-small" />
          <span>/</span>
          <input type="number" name="system.forcePoints.max" value="{{system.forcePoints.max}}" class="fp-small" />
          <select name="system.forcePoints.die" class="fp-die">
            <option value="1d6" {{#if (eq system.forcePoints.die "1d6")}}selected{{/if}}>1d6</option>
            <option value="1d8" {{#if (eq system.forcePoints.die "1d8")}}selected{{/if}}>1d8</option>
            <option value="1d10" {{#if (eq system.forcePoints.die "1d10")}}selected{{/if}}>1d10</option>
          </select>
          <div class="force-note">Base die used when spending FP</div>
        </div>

        <div class="dt-block">
          <label>Damage Threshold</label>
          <div class="dt-value">{{damageThreshold}}</div>
          <label>Misc</label>
          <input type="number" name="system.damageThresholdMisc" value="{{system.damageThresholdMisc}}" class="tiny-input" />
        </div>
      </div>
    </section>

    <aside class="combat-right">
      <div class="section-title">Defenses</div>
      <div class="def-row">
        <label>FORT</label>
        <div class="def-value">{{system.defenses.fortitude.total}}</div>
      </div>
      <div class="def-row">
        <label>REF</label>
        <div class="def-value">{{system.defenses.reflex.total}}</div>
      </div>
      <div class="def-row">
        <label>WILL</label>
        <div class="def-value">{{system.defenses.will.total}}</div>
      </div>

      <div class="condition-box">
        <label>Condition</label>
        <select name="system.conditionTrack">
          <option value="normal" {{#if (eq system.conditionTrack "normal")}}selected{{/if}}>Normal</option>
          <option value="-1" {{#if (eq system.conditionTrack "-1")}}selected{{/if}}>-1</option>
          <option value="-2" {{#if (eq system.conditionTrack "-2")}}selected{{/if}}>-2</option>
          <option value="-5" {{#if (eq system.conditionTrack "-5")}}selected{{/if}}>-5</option>
          <option value="-10" {{#if (eq system.conditionTrack "-10")}}selected{{/if}}>-10</option>
          <option value="helpless" {{#if (eq system.conditionTrack "helpless")}}selected{{/if}}>Helpless</option>
        </select>
      </div>

      <div class="second-wind-box">
        <div class="section-title">Second Wind</div>
        <div>Auto healing: <strong>{{system.secondWind.healing}}</strong></div>
        <label>Misc</label>
        <input type="number" name="system.secondWind.misc" value="{{system.secondWind.misc}}" class="tiny-input" />
        <label>Uses</label>
        <input type="number" name="system.secondWind.uses" value="{{system.secondWind.uses}}" class="tiny-input" />
        <label>Max/day</label>
        <input type="number" name="system.secondWind.max" value="{{system.secondWind.max}}" class="tiny-input" />
        <button type="button" class="apply-second-wind">Take Second Wind</button>
      </div>
    </aside>
  </section>

  <section class="tabs">
    <div class="tab-row">
      <button class="tab active" data-tab="armor">Armor & Equipment</button>
      <button class="tab" data-tab="feats">Feats & Talents</button>
      <button class="tab" data-tab="powers">Force Powers</button>
      <button class="tab" data-tab="weapons">Weapons</button>
    </div>

    <div class="tab-content armor active" id="armor-tab">
      <button class="add-armor">+ Add Armor</button>
      <div class="list-armor">
        {{#each items}}
          {{#if (eq this.type "armor")}}
            <div class="armor-entry">{{this.name}}</div>
          {{/if}}
        {{/each}}
      </div>
    </div>

    <div class="tab-content feats" id="feats-tab">
      <button class="add-feat">+ Add Feat</button>
      <div class="feats-list">
        {{#each system.feats}}
          <div class="feat-entry">{{this.name}}</div>
        {{/each}}
      </div>
    </div>

    <div class="tab-content powers" id="powers-tab">
      <button class="refresh-forcepowers">Refresh</button>
      {{#each items}}
        {{#if (eq this.type "forcepower")}}
          <div class="forcepower-entry" data-item-id="{{this._id}}">
            <div class="power-header">{{this.name}} ({{this.system.uses.current}}/{{this.system.uses.max}})</div>
            <button class="roll-forcepower">Use</button>
            <button class="reload-forcepower">Reload (FP)</button>
          </div>
        {{/if}}
      {{/each}}
    </div>

    <div class="tab-content weapons" id="weapons-tab">
      <button class="add-weapon">+ Add Weapon</button>
      {{#each system.weapons}}
        <div class="weapon-entry" data-index="{{@index}}">
          <div>{{this.name}} — Damage: {{this.damage}}</div>
          <button class="roll-weapon">Attack</button>
        </div>
      {{/each}}
    </div>
  </section>

  <footer class="sheet-footer">
    <small>SWSE — Generated by updater</small>
  </footer>
</div>

<script>
  // Minimal client-side hint: actual handlers bound in SWSEActorSheet.activateListeners
</script>

<style>
/* Keep your color theme while tightening sizes */
.character-sheet { font-family: Arial, sans-serif; color:#222; background: linear-gradient(135deg,#e8e8e8,#d4d4d4); padding:12px; border-radius:10px; }
.header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:10px; }
.header h1 { font-size:18px; letter-spacing:3px; color:#2a2a2a; }
.header .actions button { margin-left:6px; padding:4px 8px; }
.basic-info { display:grid; grid-template-columns: 1fr 1fr 160px; gap:10px; margin-bottom:12px; }
.main-layout { display:grid; grid-template-columns: 260px 1fr 260px; gap:14px; align-items:start; }
.abilities-box { background: linear-gradient(135deg,#b8b8b8,#c8c8c8); padding:8px; border-radius:8px; border: 2px solid #4a4a4a; }
.ability-row { display:flex; gap:8px; align-items:center; margin-bottom:6px; }
.ability-input { width:56px; }
.ability-mod, .ability-total { font-weight:700; width:64px; text-align:center; }
.combat-box { background: linear-gradient(135deg,#f2f2f2,#e6e6e6); padding:8px; border-radius:8px; border: 2px solid #4a4a4a; }
.hp-small { width:72px; display:inline-block; padding:4px; border-radius:6px; }
.fp-small { width:48px; display:inline-block; padding:4px; border-radius:6px; }
.fp-die { width:80px; padding:4px; }
.tiny-input { width:56px; }
.dt-block { margin-top:8px; }
.combat-right { background: linear-gradient(135deg,#dfe7ea,#cfd8db); padding:8px; border-radius:8px; border: 2px solid #4a4a4a; }
.second-wind-box { margin-top:10px; padding:8px; border-radius:6px; background: linear-gradient(135deg,#f7e6e6,#f2dede); border:2px solid #a44; }
.tabs { margin-top:12px; }
.tab-row { display:flex; gap:6px; margin-bottom:8px; }
.tab { padding:6px 10px; border-radius:6px; background:#999; color:#222; }
.tab.active { background:#c8c8c8; transform:translateY(2px); }
.tab-content { display:none; background:linear-gradient(135deg,#b8b8b8,#c8c8c8); border:2px solid #4a4a4a; padding:10px; border-radius:8px; }
.tab-content.active { display:block; }
.sheet-footer { margin-top:10px; text-align:center; color:#444; }
</style>
